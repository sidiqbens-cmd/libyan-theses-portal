<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بوابة الرسائل الجامعية الليبية | Libyan Theses Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; height: 100vh; overflow: hidden; }
        .compact-table th { background: #f8fafc; position: sticky; top: 0; z-index: 10; }
        .compact-table tr { cursor: pointer; transition: all 0.2s; }
        .compact-table tr:hover { background-color: #f0f7ff; }
        /* أنيميشن اللوحة الجانبية */
        #details-panel { transition: transform 0.3s ease-in-out; transform: translateX(100%); }
        #details-panel.open { transform: translateX(0); }
    </style>
</head>
<body class="bg-gray-50 flex flex-col">

    <header class="bg-blue-900 text-white p-2 flex justify-between items-center shadow-lg z-20">
        <div class="flex items-center gap-3">
            <h1 class="text-lg font-bold">بوابة الرسائل الجامعية الليبية</h1>
            <span class="text-[10px] bg-blue-700 px-2 py-0.5 rounded tracking-widest uppercase">Beta</span>
        </div>
        <div class="flex gap-6 text-xs font-light">
            <span>الرسائل الموثقة: <b id="stat-count" class="text-yellow-400">0</b></span>
            <span>الجامعات الشريكة: <b id="stat-unis" class="text-yellow-400">0</b></span>
        </div>
    </header>

    <main class="flex flex-1 overflow-hidden relative">
        
        <aside class="w-64 bg-white border-l shadow-inner p-4 flex flex-col gap-4 z-10">
            <div>
                <label class="text-xs text-gray-500 mb-1 block">البحث الذكي</label>
                <input type="text" id="search-input" placeholder="اسم الباحث، عنوان الرسالة..." 
                    class="w-full border rounded-md p-2 text-sm focus:ring-2 ring-blue-500 outline-none">
            </div>

            <div class="space-y-3">
                <select id="filter-uni" class="w-full border rounded p-1.5 text-xs bg-gray-50">
                    <option value="">جميع الجامعات</option>
                </select>
                <select id="filter-degree" class="w-full border rounded p-1.5 text-xs bg-gray-50">
                    <option value="">كل الدرجات العلمية</option>
                    <option value="ماجستير">ماجستير</option>
                    <option value="دكتوراه">دكتوراه</option>
                </select>
            </div>

            <div class="mt-auto border-t pt-4">
                <button onclick="window.location.href='admin.html'" class="w-full text-[10px] text-gray-400 hover:text-blue-600 transition-colors">
                    دخول المكتبات (نظام الاعتماد)
                </button>
            </div>
        </aside>

        <section class="flex-1 bg-white overflow-auto relative">
            <table class="w-full text-right text-sm compact-table">
                <thead>
                    <tr class="text-gray-600 border-b text-xs uppercase">
                        <th class="p-3">الباحث</th>
                        <th class="p-3">عنوان الرسالة</th>
                        <th class="p-3">الجامعة / الكلية</th>
                        <th class="p-3 text-center">الدرجة</th>
                        <th class="p-3 text-center">الحالة</th>
                    </tr>
                </thead>
                <tbody id="theses-list" class="divide-y divide-gray-100 font-medium">
                    </tbody>
            </table>
        </section>

        <div id="details-panel" class="absolute inset-y-0 right-0 w-80 bg-white shadow-2xl border-l z-30 p-6 flex flex-col">
            <button onclick="closeDetails()" class="absolute left-4 top-4 text-gray-400 hover:text-red-500 text-xl">✕</button>
            
            <div id="panel-content" class="mt-8 space-y-6">
                </div>
        </div>

    </main>

    <script>
        let allTheses = [];

        // 1. جلب البيانات من ملف JSON
        async function loadData() {
            try {
                const response = await fetch('theses.json');
                allTheses = await response.json();
                renderTable(allTheses);
                updateStats();
                populateFilters();
            } catch (e) {
                console.log("بانتظار ملف البيانات...");
            }
        }

        // 2. عرض الجدول
        function renderTable(data) {
            const list = document.getElementById('theses-list');
            list.innerHTML = data.map((item, index) => `
                <tr onclick="showDetails(${index})">
                    <td class="p-3 font-bold text-gray-800">${item.الباحث}</td>
                    <td class="p-3 text-blue-700">${item.العنوان}</td>
                    <td class="p-3 text-gray-500">${item.الجامعة} / ${item.الكلية}</td>
                    <td class="p-3 text-center"><span class="bg-gray-100 px-2 py-1 rounded text-[10px]">${item.الدرجة}</span></td>
                    <td class="p-3 text-center text-xs ${item.الحالة === 'متوفرة' ? 'text-green-600' : 'text-red-400'}">${item.الحالة}</td>
                </tr>
            `).join('');
        }

        // 3. عرض التفاصيل في اللوحة الجانبية
        function showDetails(index) {
            const item = allTheses[index];
            const panel = document.getElementById('details-panel');
            const content = document.getElementById('panel-content');

            content.innerHTML = `
                <div>
                    <h3 class="text-xs text-blue-500 font-bold mb-1">عنوان الرسالة</h3>
                    <p class="text-lg leading-tight font-bold text-gray-900">${item.العنوان}</p>
                </div>
                <div class="grid grid-cols-2 gap-4 text-sm font-medium">
                    <div><span class="text-xs text-gray-400 block">المشرف</span> ${item.المشرف}</div>
                    <div><span class="text-xs text-gray-400 block">السنة</span> ${item.السنة || 'غير محدد'}</div>
                    <div><span class="text-xs text-gray-400 block">القسم</span> ${item.القسم}</div>
                    <div><span class="text-xs text-gray-400 block">رقم الرسالة</span> ${item.الرقم}</div>
                </div>
                <div class="border-t pt-4">
                    <span class="text-xs text-gray-400 block mb-2">ملاحظات</span>
                    <p class="text-sm text-gray-600 italic bg-gray-50 p-2 rounded">${item.ملاحظات || 'لا توجد ملاحظات إضافية'}</p>
                </div>
                <a href="${item.الرابط}" target="_blank" class="block w-full text-center bg-blue-600 text-white py-3 rounded-lg font-bold shadow-md hover:bg-blue-700 transition-all">
                    تحميل / عرض النص الكامل
                </a>
            `;
            panel.classList.add('open');
        }

        function closeDetails() {
            document.getElementById('details-panel').classList.remove('open');
        }

        // 4. البحث والفلترة
        document.getElementById('search-input').addEventListener('input', (e) => {
            const val = e.target.value.toLowerCase();
            const filtered = allTheses.filter(t => 
                t.العنوان.toLowerCase().includes(val) || 
                t.الباحث.toLowerCase().includes(val) ||
                t.المشرف.toLowerCase().includes(val)
            );
            renderTable(filtered);
        });

        // تشغيل الوظائف عند التحميل
        loadData();
    </script>
</body>
</html>
