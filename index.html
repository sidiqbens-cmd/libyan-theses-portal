<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; margin: 0; padding: 5px; overflow: hidden; }
        .portal-header { background: white; padding: 10px 20px; border-radius: 8px; margin-bottom: 8px; border-bottom: 4px solid #1e3a8a; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .portal-title { font-size: 20px; color: #1e3a8a; font-weight: 900; }
        .filter-bar { background: #1e3a8a; padding: 8px; display: flex; gap: 6px; align-items: center; border-radius: 6px; margin-bottom: 8px; }
        .filter-input { border: 1px solid #cbd5e1; padding: 0 10px; border-radius: 4px; height: 32px; font-size: 11px; flex: 1; outline: none; }
        .table-container { background: white; border-radius: 6px; overflow: hidden; height: calc(100vh - 120px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th { background: #334155; color: white; padding: 10px 4px; border: 1px solid #1e293b; font-size: 10px; position: sticky; top: 0; z-index: 20; }
        td { border: 1px solid #e2e8f0; padding: 6px 4px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .lib-clickable { color: #1e3a8a; font-weight: bold; cursor: pointer; text-decoration: underline; }
        #libModal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(2px); }
        .modal-card { background: white; margin: 10% auto; padding: 25px; border-radius: 12px; width: 350px; border-top: 12px solid #1e3a8a; position: relative; }
    </style>
</head>
<body>

    <div id="libModal" onclick="closeModal()">
        <div class="modal-card shadow-2xl" onclick="event.stopPropagation()">
            <h2 id="modal_lib_name" class="text-xl font-black text-blue-900 mb-1"></h2>
            <p id="modal_lib_uni" class="text-sm text-gray-600 mb-4 border-b pb-2"></p>
            <div class="space-y-3 text-right">
                <div class="flex items-center gap-2"><span>ğŸ“</span> <span id="modal_lib_phone" class="font-bold"></span></div>
                <div class="flex items-center gap-2"><span>ğŸ“§</span> <span id="modal_lib_email"></span></div>
                <a id="map_link" href="#" target="_blank" class="block bg-blue-50 text-blue-700 text-center py-2 rounded-lg font-bold border border-blue-200 mt-4">ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
            </div>
            <button onclick="closeModal()" class="mt-6 w-full bg-gray-100 py-2 rounded-md font-bold text-gray-700">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <div class="portal-header">
        <div class="flex items-center gap-4">
            <h1 class="portal-title">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</h1>
            <a href="join.html" class="bg-green-600 hover:bg-green-700 text-white px-4 py-1.5 rounded-full text-[10px] font-bold shadow-sm transition-all">+ Ø§Ù†Ø¶Ù…Ø§Ù… Ù…ÙƒØªØ¨Ø©</a>
        </div>
        <div class="text-left"><span class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-[10px] font-bold">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</span></div>
    </div>

    <div class="filter-bar shadow-lg">
        <input type="text" id="f_search" class="filter-input w-1/4" placeholder="ğŸ” Ø¨Ø­Ø« Ø´Ø§Ù…Ù„..." onkeyup="filterNow()">
        <input type="text" id="f_uni" class="filter-input" placeholder="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" onkeyup="filterNow()">
        <input type="text" id="f_coll" class="filter-input" placeholder="Ø§Ù„ÙƒÙ„ÙŠØ©" onkeyup="filterNow()">
        <input type="text" id="f_dept" class="filter-input" placeholder="Ø§Ù„Ù‚Ø³Ù…" onkeyup="filterNow()">
        <input type="text" id="f_year" class="filter-input" placeholder="Ø§Ù„Ø³Ù†Ø©" onkeyup="filterNow()">
        <input type="text" id="f_loc" class="filter-input" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†" onkeyup="filterNow()">
        <select id="f_deg" class="filter-input max-w-[100px]" onchange="filterNow()">
            <option value="">Ø§Ù„Ø¯Ø±Ø¬Ø©</option><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
        </select>
    </div>

    <div class="table-container">
        <div class="overflow-y-auto h-full">
            <table>
                <thead>
                    <tr>
                        <th width="12%">Ø§Ù„Ø¨Ø§Ø­Ø«</th><th width="22%">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th width="10%">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                        <th width="8%">Ø§Ù„ÙƒÙ„ÙŠØ©</th><th width="8%">Ø§Ù„Ù‚Ø³Ù…</th><th width="5%">Ø§Ù„Ø³Ù†Ø©</th>
                        <th width="6%">Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th width="6%">Ø§Ù„Ø­Ø§Ù„Ø©</th><th width="12%">Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯</th>
                        <th width="4%">ğŸ”—</th>
                    </tr>
                </thead>
                <tbody id="thesesBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ (ØªÙ…Øª Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ù„ØªØ¹Ù…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let allData = [];
        let librariesData = {};

        // Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„
        db.ref('libraries').on('value', snap => {
            librariesData = {};
            snap.forEach(child => { librariesData[child.val().name] = child.val(); });
        });

        function fetchData() {
            db.ref('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø±Ø³Ø§Ø¦Ù„').on('value', snap => {
                allData = [];
                snap.forEach(child => { allData.push(child.val()); });
                renderTable(allData.slice().reverse());
            });
        }

        function renderTable(data) {
            const tbody = document.getElementById('thesesBody');
            tbody.innerHTML = "";
            data.forEach(d => {
                tbody.innerHTML += `
                    <tr>
                        <td>${d.Ø§Ù„Ø¨Ø§Ø­Ø« || '-'}</td>
                        <td class="text-right font-bold px-2 text-blue-900">${d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù† || '-'}</td>
                        <td>${d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© || '-'}</td><td>${d.Ø§Ù„ÙƒÙ„ÙŠØ© || '-'}</td><td>${d.Ø§Ù„Ù‚Ø³Ù… || '-'}</td>
                        <td>${d.Ø§Ù„Ø³Ù†Ø© || '-'}</td><td>${d.Ø§Ù„Ø¯Ø±Ø¬Ø© || '-'}</td>
                        <td><span class="${d.Ø§Ù„Ø­Ø§Ù„Ø© === 'Ù…ØªÙˆÙØ±Ø©' ? 'text-green-600 font-bold' : 'text-red-600'}">${d.Ø§Ù„Ø­Ø§Ù„Ø© || '-'}</span></td>
                        <td class="lib-clickable" onclick="openLibInfo('${d.Ù…ÙƒØ§Ù†_Ø§Ù„ØªÙˆØ§Ø¬Ø¯}')">ğŸ“ ${d.Ù…ÙƒØ§Ù†_Ø§Ù„ØªÙˆØ§Ø¬Ø¯ || '-'}</td>
                        <td>${d.Ø§Ù„Ø±Ø§Ø¨Ø· ? `<a href="${d.Ø§Ù„Ø±Ø§Ø¨Ø·}" target="_blank">ğŸ“„</a>` : '-'}</td>
                    </tr>`;
            });
        }

        function filterNow() {
            const s = document.getElementById('f_search').value.toLowerCase();
            const uni = document.getElementById('f_uni').value.toLowerCase();
            const coll = document.getElementById('f_coll').value.toLowerCase();
            const dept = document.getElementById('f_dept').value.toLowerCase();
            const year = document.getElementById('f_year').value.toLowerCase();
            const loc = document.getElementById('f_loc').value.toLowerCase();
            const deg = document.getElementById('f_deg').value;

            const filtered = allData.filter(d => {
                return ( (d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + d.Ø§Ù„Ø¨Ø§Ø­Ø«).toLowerCase().includes(s) ) &&
                       ( !uni || (d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© || '').toLowerCase().includes(uni) ) &&
                       ( !coll || (d.Ø§Ù„ÙƒÙ„ÙŠØ© || '').toLowerCase().includes(coll) ) &&
                       ( !dept || (d.Ø§Ù„Ù‚Ø³Ù… || '').toLowerCase().includes(dept) ) &&
                       ( !year || (d.Ø§Ù„Ø³Ù†Ø© || '').toString().includes(year) ) &&
                       ( !loc || (d.Ù…ÙƒØ§Ù†_Ø§Ù„ØªÙˆØ§Ø¬Ø¯ || '').toLowerCase().includes(loc) ) &&
                       ( !deg || d.Ø§Ù„Ø¯Ø±Ø¬Ø© === deg );
            });
            renderTable(filtered);
        }

        function openLibInfo(name) {
            const lib = librariesData[name];
            if (lib) {
                document.getElementById('modal_lib_name').innerText = lib.name;
                document.getElementById('modal_lib_uni').innerText = lib.university + " - " + (lib.college || "");
                document.getElementById('modal_lib_phone').innerText = lib.phone || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
                document.getElementById('modal_lib_email').innerText = lib.email || "ØºÙŠØ± Ù…ØªÙˆÙØ±";
                document.getElementById('map_link').href = lib.mapUrl || "#";
                document.getElementById('libModal').style.display = "block";
            }
        }

        function closeModal() { document.getElementById('libModal').style.display = "none"; }
        fetchData();
    </script>
</body>
</html>
