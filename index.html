<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ø§Ù„Ø¨Ø­Ø«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-size: 11px; background-color: #f1f5f9; font-family: sans-serif; }
        .main-card { background: white; border: 1px solid #cbd5e1; }
        th { background: #1e3a8a; color: white; padding: 4px; border: 1px solid #475569; white-space: nowrap; font-size: 10px; }
        td { padding: 3px; border: 1px solid #cbd5e1; text-align: center; color: #334155; }
        input, select { width: 100%; padding: 4px; border: 1px solid #94a3b8; border-radius: 2px; font-size: 10px; height: 26px; }
        tr:nth-child(even) { background-color: #f8fafc; }
    </style>
</head>
<body class="p-1">

    <div class="flex justify-between items-center mb-1 bg-white p-2 border border-slate-300">
        <h1 class="text-blue-900 font-bold text-sm italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
        <a href="join.html" class="bg-green-700 text-white px-3 py-1 rounded text-[10px] font-bold">â• Ø§Ù†Ø¶Ù…Ø§Ù… Ù…ÙƒØªØ¨Ø©</a>
    </div>

    <div class="main-card p-1 bg-slate-100 grid grid-cols-7 gap-1 border-b-0">
        <input type="text" id="f_gs" placeholder="ğŸ” Ø¨Ø­Ø« Ø´Ø§Ù…Ù„..." onkeyup="filterTable()">
        <input type="text" id="f_uni" placeholder="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" onkeyup="filterTable()">
        <input type="text" id="f_coll" placeholder="Ø§Ù„ÙƒÙ„ÙŠØ©" onkeyup="filterTable()">
        <input type="text" id="f_dept" placeholder="Ø§Ù„Ù‚Ø³Ù…" onkeyup="filterTable()">
        <input type="text" id="f_year" placeholder="Ø§Ù„Ø³Ù†Ø©" onkeyup="filterTable()">
        <input type="text" id="f_loc" placeholder="Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯" onkeyup="filterTable()">
        <select id="f_deg" onchange="filterTable()">
            <option value="">ÙƒÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</option>
            <option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
            <option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option>
        </select>
    </div>

    <div class="main-card overflow-x-auto">
        <table class="w-full border-collapse min-w-[1100px]">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¨Ø§Ø­Ø«</th>
                    <th class="w-1/4">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                    <th>Ø§Ù„Ù…Ø´Ø±Ù</th>
                    <th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                    <th>Ø§Ù„ÙƒÙ„ÙŠØ©</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø³Ù†Ø©</th>
                    <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                    <th class="w-16">Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                    <th>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯</th> 
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th class="w-16">Ø¹Ø±Ø¶</th>
                </tr>
            </thead>
            <tbody id="thesesTableBody"></tbody>
        </table>
    </div>

    <div id="libraryModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded shadow-xl max-w-sm w-full border-t-4 border-blue-900 overflow-hidden text-right">
            <div class="bg-slate-50 p-2 border-b flex justify-between items-center">
                <h3 id="libName" class="font-bold text-blue-900 text-xs">Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø©</h3>
                <button onclick="closeLibModal()" class="text-gray-400 hover:text-red-600 text-xl">Ã—</button>
            </div>
            <div class="p-4 space-y-3">
                <div id="libDetails" class="text-[11px] text-gray-700 space-y-1"></div>
                <div id="libLinks" class="flex gap-2 border-t pt-2 justify-center"></div>
                <div id="libMap" class="w-full h-32 bg-gray-100 rounded border overflow-hidden"></div>
            </div>
            <button onclick="closeLibModal()" class="w-full bg-slate-800 text-white py-2 text-[10px] font-bold">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc", 
            authDomain: "libyan-theses-portal.firebaseapp.com", 
            projectId: "libyan-theses-portal", 
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app", 
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc" 
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadData() {
            db.ref('theses_data').on('value', snap => {
                const tbody = document.getElementById('thesesTableBody');
                tbody.innerHTML = '';
                snap.forEach(child => {
                    const v = child.val();
                    tbody.innerHTML += `<tr>
                        <td>${v.author || ''}</td>
                        <td class="text-right px-2 font-bold">${v.title || ''}</td>
                        <td>${v.supervisor || ''}</td>
                        <td>${v.university || ''}</td>
                        <td>${v.college || ''}</td>
                        <td>${v.department || ''}</td>
                        <td>${v.year || ''}</td>
                        <td>${v.degree || ''}</td>
                        <td class="font-bold text-blue-900 bg-slate-50">${v.serialNum || '-'}</td>
                        <td class="cursor-pointer text-blue-600 font-bold hover:bg-blue-100" onclick="showLibraryCard('${v.location}')">ğŸ“ ${v.location || ''}</td>
                        <td>${v.link ? `<a href="${v.link}" target="_blank" class="text-blue-600 font-bold underline">Ø¹Ø±Ø¶</a>` : '-'}</td>
                    </tr>`;
                });
            });
        }
        loadData();

        function filterTable() {
            const f = [
                document.getElementById('f_gs').value.toLowerCase(),
                document.getElementById('f_uni').value.toLowerCase(),
                document.getElementById('f_coll').value.toLowerCase(),
                document.getElementById('f_dept').value.toLowerCase(),
                document.getElementById('f_year').value.toLowerCase(),
                document.getElementById('f_loc').value.toLowerCase(),
                document.getElementById('f_deg').value.toLowerCase()
            ];

            document.querySelectorAll('#thesesTableBody tr').forEach(row => {
                const c = row.children;
                const match = row.innerText.toLowerCase().includes(f[0]) &&
                              c[3].innerText.toLowerCase().includes(f[1]) && 
                              c[4].innerText.toLowerCase().includes(f[2]) && 
                              c[5].innerText.toLowerCase().includes(f[3]) && 
                              c[6].innerText.toLowerCase().includes(f[4]) && 
                              c[9].innerText.toLowerCase().includes(f[5]) && 
                              (f[6] === "" || c[7].innerText.toLowerCase().includes(f[6]));
                
                row.style.display = match ? "" : "none";
            });
        }

        function showLibraryCard(locName) {
            db.ref('libraries_info/' + locName).once('value', snap => {
                const lib = snap.val();
                document.getElementById('libName').innerText = locName;
                const details = document.getElementById('libDetails');
                const links = document.getElementById('libLinks');
                const mapDiv = document.getElementById('libMap');
                
                if(lib) {
                    details.innerHTML = `
                        <p><b>Ø§Ù„ØªØ¨Ø¹ÙŠØ©:</b> ${lib.affiliation || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p><b>Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯:</b> ${lib.hours || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}</p>
                        <p><b>Ø§Ù„Ù‡Ø§ØªÙ:</b> <span dir="ltr">${lib.phone || '-'}</span></p>
                        <p><b>Ø§Ù„Ø¨Ø±ÙŠØ¯:</b> ${lib.email || '-'}</p>`;
                    
                    links.innerHTML = '';
                    if(lib.fb) links.innerHTML += `<a href="${lib.fb}" target="_blank" class="bg-blue-600 text-white px-2 py-1 rounded text-[9px]">ÙÙŠØ³Ø¨ÙˆÙƒ</a>`;
                    if(lib.web) links.innerHTML += `<a href="${lib.web}" target="_blank" class="bg-slate-700 text-white px-2 py-1 rounded text-[9px]">Ù…ÙˆÙ‚Ø¹</a>`;
                    
                    let mapUrl = lib.map ? (lib.map.includes('pb=') ? lib.map : `https://maps.google.com/maps?q=${encodeURIComponent(locName)}&output=embed`) : '';
                    mapDiv.innerHTML = mapUrl ? `<iframe width="100%" height="100%" frameborder="0" src="${mapUrl}"></iframe>` : '<div class="p-5 text-gray-400 text-center">Ø§Ù„Ø®Ø±ÙŠØ·Ø© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</div>';
                } else {
                    details.innerHTML = '<p class="italic text-orange-600 py-4 text-center">Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù„Ù… ØªÙ†Ø¶Ù… Ù„Ù„ÙÙ‡Ø±Ø³ Ø¨Ø¹Ø¯.</p>';
                    links.innerHTML = '';
                    mapDiv.innerHTML = '<div class="flex items-center justify-center h-full text-gray-300 text-3xl">ğŸ›ï¸</div>';
                }
                document.getElementById('libraryModal').classList.remove('hidden');
            });
        }
        function closeLibModal() { document.getElementById('libraryModal').classList.add('hidden'); }
    </script>
</body>
</html>
