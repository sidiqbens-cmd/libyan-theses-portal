<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الفهرس الليبي الموحد | بحث الرسائل الجامعية</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; }
        .dense-table th, .dense-table td { padding: 8px 10px; font-size: 12px; border-bottom: 1px solid #e2e8f0; }
        .dense-table tr:hover { background-color: #f8fafc; }
    </style>
</head>
<body class="p-2 md:p-4">

<div class="max-w-7xl mx-auto">
    <div class="bg-blue-900 text-white p-4 rounded-xl shadow-lg mb-4">
        <h1 class="text-xl font-bold mb-4 text-center">بوابة الرسائل الجامعية الليبية</h1>
        
        <input type="text" id="searchInput" placeholder="ابحث بالاسم، العنوان، أو المشرف..." 
               class="w-full p-2 rounded-lg text-black text-sm mb-4 outline-none focus:ring-2 focus:ring-blue-400">
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
            <select id="filterUniversity" class="text-black p-2 rounded text-xs"><option value="">كل الجامعات</option></select>
            <select id="filterFaculty" class="text-black p-2 rounded text-xs"><option value="">كل الكليات</option></select>
            <select id="filterDept" class="text-black p-2 rounded text-xs"><option value="">كل الأقسام</option></select>
            <select id="filterYear" class="text-black p-2 rounded text-xs"><option value="">كل السنوات</option></select>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-md overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-right text-xs dense-table">
                <thead class="bg-slate-100 text-blue-900 border-b">
                    <tr>
                        <th class="p-2">الباحث</th>
                        <th class="p-2">عنوان الرسالة</th>
                        <th class="p-2">المشرف</th>
                        <th class="p-2">الجامعة</th>
                        <th class="p-2">الكلية</th>
                        <th class="p-2">القسم</th>
                        <th class="p-2">السنة</th>
                        <th class="p-2">رقم الرسالة</th>
                        <th class="p-2">حالة الرسالة</th>
                        <th class="p-2">رابط</th>
                        <th class="p-2">ملاحظات</th>
                    </tr>
                </thead>
                <tbody id="thesesTable" class="divide-y divide-gray-200">
                    </tbody>
            </table>
        </div>
        <div id="loader" class="p-10 text-center text-blue-900 font-bold">جاري تحميل البيانات من السحاب...</div>
    </div>
</div>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
          apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
          authDomain: "libyan-theses-portal.firebaseapp.com",
          projectId: "libyan-theses-portal",
          // السطر المفقود الذي يجب إضافته هو التالي:
          databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
          storageBucket: "libyan-theses-portal.appspot.com",
          messagingSenderId: "80818219253",
          appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // جلب البيانات وعرضها
        const thesesTable = document.getElementById('thesesTable');
        const loader = document.getElementById('loader');

        database.ref('theses').on('value', (snapshot) => {
            loader.style.display = 'none';
            thesesTable.innerHTML = '';
            const data = snapshot.val();
            
            if (data) {
                Object.values(data).reverse().forEach(item => {
                    const row = `
                        <tr>
                            <td class="font-bold text-blue-800">${item.university}</td>
                            <td>${item.author}</td>
                            <td class="text-blue-900 font-medium">${item.title}</td>
                            <td>${item.faculty} / ${item.dept}</td>
                            <td><span class="bg-blue-100 text-blue-800 px-2 py-0.5 rounded-full text-[10px]">${item.degree}</span></td>
                            <td class="text-gray-500">${item.dateAdded || '-'}</td>
                            <td class="text-gray-400 italic">${item.notes || '-'}</td>
                        </tr>
                    `;
                    thesesTable.innerHTML += row;
                });
            } else {
                thesesTable.innerHTML = '<tr><td colspan="7" class="p-10 text-center text-gray-500">لا توجد بيانات مسجلة حالياً</td></tr>';
            }
        });

        // ميزة البحث الفوري
        document.getElementById('searchInput').addEventListener('keyup', function() {
            const filter = this.value.toLowerCase();
            const rows = thesesTable.getElementsByTagName('tr');
            for (let i = 0; i < rows.length; i++) {
                rows[i].style.display = rows[i].innerText.toLowerCase().includes(filter) ? '' : 'none';
            }
        });
    </script>
</body>
</html>
