<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุจูุงุจุฉ ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ ุงูููุจูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', Tahoma, sans-serif; }
        .header-bg { background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); }
        /* ุจุทุงูุฉ ุจูุงูุงุช ุงูููุชุจุฉ ููุฌูููุฑ */
        #libModal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; padding: 25px; border-radius: 15px; width: 100%; max-width: 400px; position: relative; border-top: 6px solid #1e3a8a; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #f1f5f9; color: #1e3a8a; padding: 12px; border-bottom: 2px solid #e2e8f0; text-align: right; }
        td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        .link-icon { color: #2563eb; text-decoration: none; font-size: 18px; }
    </style>
</head>
<body>

    <div id="libModal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="text-center mb-5">
                <div class="text-5xl mb-2">๐๏ธ</div>
                <h2 id="mLibName" class="font-bold text-blue-900 text-xl"></h2>
                <p class="text-gray-500 text-xs mt-1">ุชูุงุตูู ุฌูุฉ ุงูุฅูุฏุงุน</p>
            </div>
            <div class="space-y-3 text-sm border-t pt-4">
                <div class="flex justify-between border-b pb-2"><b>ุงููุฏููุฉ:</b> <span id="mCity" class="text-blue-700 font-bold"></span></div>
                <div class="flex justify-between border-b pb-2"><b>ุงูุฌุงูุนุฉ ุงูุชุงุจุนุฉ:</b> <span id="mUni" class="text-blue-700 font-bold"></span></div>
                <div class="flex justify-between border-b pb-2"><b>ุงููุณุคูู:</b> <span id="mManager" class="text-blue-700 font-bold"></span></div>
                <div class="flex justify-between border-b pb-2"><b>ุฑูู ุงูุชูุงุตู:</b> <span id="mPhone" class="text-blue-700 font-bold" dir="ltr"></span></div>
            </div>
            <button onclick="document.getElementById('libModal').style.display='none'" class="w-full mt-6 bg-blue-900 text-white py-2 rounded-lg font-bold hover:bg-blue-800 transition-colors">ุฅุบูุงู ุงููุงูุฐุฉ</button>
        </div>
    </div>

    <header class="header-bg text-white py-8 shadow-2xl mb-6">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl font-black mb-2 tracking-tight">ุจูุงุจุฉ ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ ุงูููุจูุฉ</h1>
            <p class="text-blue-100 opacity-80">ุงูููุตุฉ ุงููุฑูุฒูุฉ ููุจุญุซ ูู ุงููุชุงุฌ ุงูุนููู ุงูุฌุงูุนู ุงูููุจู</p>
        </div>
    </header>

    <main class="container mx-auto px-4">
        <div class="bg-white p-4 rounded-xl shadow-md mb-6 grid grid-cols-1 md:grid-cols-5 gap-3">
            <input type="text" id="mainSearch" onkeyup="searchData()" placeholder="ุงุจุญุซ ุจุงูุนููุงูุ ุงูุจุงุญุซุ ุฃู ุงููููุงุช ุงูููุชุงุญูุฉ..." class="md:col-span-2 border p-2 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
            <select id="filterUni" onchange="searchData()" class="border p-2 rounded-lg"><option value="">ูู ุงูุฌุงูุนุงุช</option></select>
            <select id="filterDeg" onchange="searchData()" class="border p-2 rounded-lg"><option value="">ุงูุฏุฑุฌุฉ ุงูุนูููุฉ</option><option>ูุงุฌุณุชูุฑ</option><option>ุฏูุชูุฑุงู</option></select>
            <select id="filterYear" onchange="searchData()" class="border p-2 rounded-lg"><option value="">ูู ุงูุณููุงุช</option></select>
        </div>

        <div class="bg-white rounded-xl shadow-xl overflow-hidden mb-12">
            <div class="overflow-x-auto">
                <table id="resultsTable">
                    <thead>
                        <tr>
                            <th>ุงูุจุงุญุซ</th>
                            <th>ุนููุงู ุงูุฑุณุงูุฉ</th>
                            <th>ุงูุฌุงูุนุฉ/ุงููููุฉ</th>
                            <th>ููุงู ุงูุชูุงุฌุฏ</th>
                            <th>ุงูุณูุฉ</th>
                            <th>ุงูุฏุฑุฌุฉ</th>
                            <th width="50px">ุงูุฑุงุจุท</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // ุฅุนุฏุงุฏุงุช Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allTheses = [];
        let allLibs = {};

        // ุฌูุจ ุจูุงูุงุช ุงูููุชุจุงุช ุฃููุงู ูุชุฌููุฒ ุงูุจุทุงูุงุช
        function fetchInitialData() {
            db.ref('libraries').once('value', snap => {
                snap.forEach(child => { allLibs[child.val().libName] = child.val(); });
                fetchTheses();
            });
        }

        function fetchTheses() {
            db.ref('ุจูุงูุงุช_ุงูุฑุณุงุฆู').on('value', snap => {
                allTheses = [];
                snap.forEach(child => { allTheses.push(child.val()); });
                renderTable(allTheses);
                populateFilters();
            });
        }

        function showLibCard(libName) {
            const lib = allLibs[libName];
            if (lib) {
                document.getElementById('mLibName').innerText = lib.libName;
                document.getElementById('mCity').innerText = lib.city || "ุบูุฑ ูุญุฏุฏ";
                document.getElementById('mUni').innerText = lib.university || "ุชุจุนูุฉ ูุจุงุดุฑุฉ";
                document.getElementById('mManager').innerText = lib.manager || "ุบูุฑ ูุชุงุญ";
                document.getElementById('mPhone').innerText = lib.phone || "ูุง ููุฌุฏ ุฑูู";
                document.getElementById('libModal').style.display = 'flex';
            } else {
                alert("ุจูุงูุงุช ูุฐู ุงูููุชุจุฉ ุบูุฑ ูุชููุฑุฉ ุญุงููุงู");
            }
        }

        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = data.map(item => `
                <tr class="hover:bg-blue-50 transition-colors">
                    <td class="font-medium text-gray-700">${item.ุงูุจุงุญุซ}</td>
                    <td class="font-bold text-blue-900">${item.ุงูุนููุงู}</td>
                    <td>${item.ุงูุฌุงูุนุฉ} / ${item.ุงููููุฉ}</td>
                    <td class="cursor-pointer text-blue-600 font-bold hover:underline" onclick="showLibCard('${item.ุงูููุงู}')">
                        ${item.ุงูููุงู} <span title="ุจูุงูุงุช ุงูุชูุงุตู" class="text-[10px] bg-blue-100 px-1 rounded">โน๏ธ</span>
                    </td>
                    <td class="text-center">${item.ุงูุณูุฉ}</td>
                    <td class="text-center"><span class="bg-gray-100 px-2 py-1 rounded text-[11px]">${item.ุงูุฏุฑุฌุฉ}</span></td>
                    <td class="text-center">
                        ${item.ุงูุฑุงุจุท && item.ุงูุฑุงุจุท !== "#" ? `<a href="${item.ุงูุฑุงุจุท}" target="_blank" class="link-icon" title="ูุชุญ ุงูููู">๐</a>` : '<span class="text-gray-300">-</span>'}
                    </td>
                </tr>
            `).join('');
        }

        // ุฏูุงู ุงูุจุญุซ ูุงูููุชุฑุฉ (ุชุชู ููุง)
        function searchData() {
            const txt = document.getElementById('mainSearch').value.toLowerCase();
            const uni = document.getElementById('filterUni').value;
            const deg = document.getElementById('filterDeg').value;
            const yr = document.getElementById('filterYear').value;

            const filtered = allTheses.filter(t => {
                return (t.ุงูุนููุงู + t.ุงูุจุงุญุซ).toLowerCase().includes(txt) &&
                       (!uni || t.ุงูุฌุงูุนุฉ === uni) &&
                       (!deg || t.ุงูุฏุฑุฌุฉ === deg) &&
                       (!yr || t.ุงูุณูุฉ === yr);
            });
            renderTable(filtered);
        }

        function populateFilters() {
            const unis = [...new Set(allTheses.map(t => t.ุงูุฌุงูุนุฉ))].filter(Boolean).sort();
            const years = [...new Set(allTheses.map(t => t.ุงูุณูุฉ))].filter(Boolean).sort().reverse();
            
            const uniSelect = document.getElementById('filterUni');
            const yrSelect = document.getElementById('filterYear');
            
            uniSelect.innerHTML = '<option value="">ูู ุงูุฌุงูุนุงุช</option>' + unis.map(u => `<option>${u}</option>`).join('');
            yrSelect.innerHTML = '<option value="">ูู ุงูุณููุงุช</option>' + years.map(y => `<option>${y}</option>`).join('');
        }

        window.onload = fetchInitialData;
    </script>
</body>
</html>
