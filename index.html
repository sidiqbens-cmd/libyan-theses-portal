<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ© | Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f1f5f9; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 11px; margin: 0; padding: 4px; overflow: hidden; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨ÙˆØ§Ø¨Ø©: Ù‡ÙŠØ¯Ø± ÙˆØ§Ø³Ø¹ ÙˆÙØ®Ù… */
        .portal-header { 
            background: white; 
            padding: 15px 25px; 
            border-radius: 8px; 
            margin-bottom: 8px; 
            border-bottom: 4px solid #1e3a8a;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .portal-title { font-size: 22px; color: #1e3a8a; font-weight: 900; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
        .filter-bar { 
            background: #1e3a8a; 
            padding: 8px 12px; 
            display: flex; 
            gap: 6px; 
            align-items: center; 
            border-radius: 6px; 
            margin-bottom: 6px; 
        }
        .filter-input { 
            border: 1px solid #cbd5e1; 
            padding: 4px 10px; 
            border-radius: 4px; 
            height: 32px; 
            font-size: 11px; 
            flex: 1; 
            outline: none; 
        }
        .filter-input:focus { border-color: #fbbf24; background: #fff; box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2); }
        
        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .table-container { background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; height: calc(100vh - 125px); }
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th { background: #334155; color: white; padding: 10px 4px; border: 1px solid #1e293b; font-size: 10px; position: sticky; top: 0; z-index: 20; }
        td { border: 1px solid #e2e8f0; padding: 6px 4px; text-align: center; font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        tr:nth-child(even) { background: #f8fafc; }
        tr:hover { background: #fffbeb; }

        .tag-available { background: #dcfce7; color: #166534; padding: 2px 6px; border-radius: 10px; font-weight: bold; font-size: 9px; }
        .tag-unavailable { background: #fee2e2; color: #991b1b; padding: 2px 6px; border-radius: 10px; font-weight: bold; font-size: 9px; }
    </style>
</head>
<body>

    <div class="portal-header">
        <div>
            <h1 class="portal-title">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</h1>
            <p class="text-gray-500 font-medium">Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø¹Ù„Ù…ÙŠ ÙˆØ§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</p>
        </div>
        <div class="text-left hidden md:block">
            <div class="text-blue-900 font-bold">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ</div>
            <div class="text-[10px] text-gray-400 text-left">ØªØ­Ø¯ÙŠØ«: ÙØ¨Ø±Ø§ÙŠØ± 2026</div>
        </div>
    </div>

    <div class="filter-bar shadow-lg">
        <input type="text" id="f_search" class="filter-input w-1/4" placeholder="ğŸ” Ø¨Ø­Ø« Ø´Ø§Ù…Ù„ ÙÙŠ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†..." onkeyup="filterData()">
        <input type="text" id="f_uni" class="filter-input" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" onkeyup="filterData()">
        <input type="text" id="f_coll" class="filter-input" placeholder="Ø§Ù„ÙƒÙ„ÙŠØ©" onkeyup="filterData()">
        <input type="text" id="f_dept" class="filter-input" placeholder="Ø§Ù„Ù‚Ø³Ù…" onkeyup="filterData()">
        <input type="text" id="f_year" class="filter-input" placeholder="Ø§Ù„Ø³Ù†Ø©" onkeyup="filterData()">
        <input type="text" id="f_loc" class="filter-input" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†" onkeyup="filterData()">
        <select id="f_deg" class="filter-input max-w-[120px]" onchange="filterData()">
            <option value="">ÙƒÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</option>
            <option value="Ù…Ø§Ø¬Ø³ØªÙŠØ±">Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
            <option value="Ø¯ÙƒØªÙˆØ±Ø§Ù‡">Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
        </select>
    </div>

    <div class="table-container">
        <div class="overflow-y-auto h-full">
            <table id="resultsTable">
                <thead>
                    <tr>
                        <th width="11%">Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«</th>
                        <th width="20%">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</th>
                        <th width="8%">Ø§Ù„Ù…Ø´Ø±Ù</th>
                        <th width="8%">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                        <th width="8%">Ø§Ù„ÙƒÙ„ÙŠØ©</th>
                        <th width="7%">Ø§Ù„Ù‚Ø³Ù…</th>
                        <th width="5%">Ø§Ù„Ø³Ù†Ø©</th>
                        <th width="6%">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                        <th width="6%">Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                        <th width="6%">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th width="9%">Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯</th>
                        <th width="6%">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        <th width="3%">ğŸ”—</th>
                    </tr>
                </thead>
                <tbody id="thesesBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let allData = [];

        function fetchData() {
            db.ref('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø±Ø³Ø§Ø¦Ù„').on('value', snap => {
                allData = [];
                snap.forEach(child => { allData.push(child.val()); });
                renderTable(allData.reverse());
            });
        }

        function renderTable(data) {
            const tbody = document.getElementById('thesesBody');
            tbody.innerHTML = "";
            data.forEach(d => {
                tbody.innerHTML += `
                    <tr>
                        <td title="${d.Ø§Ù„Ø¨Ø§Ø­Ø«}">${d.Ø§Ù„Ø¨Ø§Ø­Ø« || '-'}</td>
                        <td class="text-right font-bold px-2 text-blue-900" title="${d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù†}">${d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù† || '-'}</td>
                        <td>${d.Ø§Ù„Ù…Ø´Ø±Ù || '-'}</td>
                        <td>${d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© || '-'}</td>
                        <td>${d.Ø§Ù„ÙƒÙ„ÙŠØ© || '-'}</td>
                        <td>${d.Ø§Ù„Ù‚Ø³Ù… || '-'}</td>
                        <td>${d.Ø§Ù„Ø³Ù†Ø© || '-'}</td>
                        <td>${d.Ø§Ù„Ø¯Ø±Ø¬Ø© || '-'}</td>
                        <td>${d.Ø±Ù‚Ù…_Ø§Ù„Ø±Ø³Ø§Ù„Ø© || '-'}</td>
                        <td><span class="${d.Ø§Ù„Ø­Ø§Ù„Ø© === 'Ù…ØªÙˆÙØ±Ø©' ? 'tag-available' : 'tag-unavailable'}">${d.Ø§Ù„Ø­Ø§Ù„Ø© || '-'}</span></td>
                        <td>${d.Ù…ÙƒØ§Ù†_Ø§Ù„ØªÙˆØ§Ø¬Ø¯ || '-'}</td>
                        <td title="${d.Ù…Ù„Ø§Ø­Ø¸Ø§Øª}">${d.Ù…Ù„Ø§Ø­Ø¸Ø§Øª || '-'}</td>
                        <td>${d.Ø§Ù„Ø±Ø§Ø¨Ø· ? `<a href="${d.Ø§Ù„Ø±Ø§Ø¨Ø·}" target="_blank">ğŸ“„</a>` : '-'}</td>
                    </tr>`;
            });
        }

        function filterData() {
            const s = document.getElementById('f_search').value.toLowerCase();
            const uni = document.getElementById('f_uni').value.toLowerCase();
            const coll = document.getElementById('f_coll').value.toLowerCase();
            const dept = document.getElementById('f_dept').value.toLowerCase();
            const year = document.getElementById('f_year').value.toLowerCase();
            const loc = document.getElementById('f_loc').value.toLowerCase();
            const deg = document.getElementById('f_deg').value;

            const filtered = allData.filter(d => {
                const textSearch = (d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù† + d.Ø§Ù„Ø¨Ø§Ø­Ø« + d.Ø§Ù„Ù…Ø´Ø±Ù).toLowerCase();
                return (textSearch.includes(s)) &&
                       (!uni || (d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© && d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©.toLowerCase().includes(uni))) &&
                       (!coll || (d.Ø§Ù„ÙƒÙ„ÙŠØ© && d.Ø§Ù„ÙƒÙ„ÙŠØ©.toLowerCase().includes(coll))) &&
                       (!dept || (d.Ø§Ù„Ù‚Ø³Ù… && d.Ø§Ù„Ù‚Ø³Ù….toLowerCase().includes(dept))) &&
                       (!year || (d.Ø§Ù„Ø³Ù†Ø© && d.Ø§Ù„Ø³Ù†Ø©.toString().includes(year))) &&
                       (!loc || (d.Ù…ÙƒØ§Ù†_Ø§Ù„ØªÙˆØ§Ø¬Ø¯ && d.Ù…ÙƒØ§Ù†_Ø§Ù„ØªÙˆØ§Ø¬Ø¯.toLowerCase().includes(loc))) &&
                       (!deg || d.Ø§Ù„Ø¯Ø±Ø¬Ø© === deg);
            });
            renderTable(filtered);
        }

        fetchData();
    </script>
</body>
</html>
