<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>البحث | الفهرس الليبي الموحد</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', sans-serif; }
        .search-box { background: white; border-radius: 8px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); }
        th { background: #1e3a8a; color: white; padding: 10px; border: 1px solid #e2e8f0; }
        td { padding: 8px; border: 1px solid #e2e8f0; text-align: center; font-size: 13px; }
        tr:nth-child(even) { background-color: #f1f5f9; }
        .pdf-link { color: #dc2626; font-weight: bold; text-decoration: underline; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-6xl mx-auto text-center mb-6">
        <h1 class="text-3xl font-bold text-blue-900 mb-2">الفهرس الليبي الموحد</h1>
        <p class="text-gray-600">بوابة البحث الموحدة عن الرسائل العلمية في الجامعات الليبية</p>
    </div>

    <div class="max-w-6xl mx-auto search-box p-6 mb-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <input type="text" id="searchTitle" placeholder="ابحث بالعنوان أو الكلمات المفتاحية..." class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500 text-right">
            <input type="text" id="searchAuthor" placeholder="ابحث باسم الباحث..." class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-500 text-right">
            <button onclick="searchData()" class="bg-blue-900 text-white font-bold py-2 px-6 rounded hover:bg-black transition-all">بـحـث</button>
        </div>
    </div>

    <div class="max-w-6xl mx-auto bg-white rounded shadow overflow-hidden">
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th width="20%">اسم الباحث</th>
                    <th width="40%">عنوان الرسالة</th>
                    <th width="15%">الجامعة</th>
                    <th width="10%">السنة</th>
                    <th width="10%">الدرجة</th>
                    <th width="5%">الملف</th>
                </tr>
            </thead>
            <tbody id="resultsTable">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function displayData(data) {
            const tbody = document.getElementById('resultsTable');
            tbody.innerHTML = "";
            data.forEach(item => {
                tbody.innerHTML += `
                    <tr>
                        <td class="font-semibold">${item.الباحث}</td>
                        <td class="text-right px-4 text-blue-900 font-bold">${item.العنوان}</td>
                        <td>${item.الجامعة}</td>
                        <td>${item.السنة}</td>
                        <td>${item.الدرجة}</td>
                        <td>
                            ${item.الرابط ? `<a href="${item.الرابط}" target="_blank" class="pdf-link">PDF</a>` : '<span class="text-gray-400">❌</span>'}
                        </td>
                    </tr>`;
            });
        }

        function searchData() {
            const titleVal = document.getElementById('searchTitle').value.toLowerCase();
            const authorVal = document.getElementById('searchAuthor').value.toLowerCase();

            db.ref('بيانات_الرسائل').once('value', snap => {
                let results = [];
                snap.forEach(child => {
                    const d = child.val();
                    const matchTitle = d.العنوان && d.العنوان.toLowerCase().includes(titleVal);
                    const matchAuthor = d.الباحث && d.الباحث.toLowerCase().includes(authorVal);
                    
                    if (matchTitle && matchAuthor) {
                        results.push(d);
                    }
                });
                displayData(results);
            });
        }

        // جلب البيانات عند فتح الصفحة لأول مرة
        window.onload = () => {
            db.ref('بيانات_الرسائل').limitToLast(20).once('value', snap => {
                let results = [];
                snap.forEach(child => results.push(child.val()));
                displayData(results.reverse());
            });
        };
    </script>
</body>
</html>
