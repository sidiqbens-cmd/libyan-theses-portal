<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | ØµÙØ­Ø© Ø§Ù„Ø¨Ø­Ø«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f1f5f9; overflow: hidden; }
        .filter-select { padding: 4px 8px; border-radius: 4px; border: 1px solid #cbd5e1; font-size: 11px; }
        th { background-color: #1e3a8a; color: white; font-size: 10px; padding: 6px; position: sticky; top: 0; }
        td { font-size: 11px; border-bottom: 1px solid #e2e8f0; padding: 4px; background: white; }
        .scroll-container { height: calc(100vh - 120px); overflow-y: auto; }
    </style>
</head>
<body class="p-2">

    <div class="bg-white shadow-md mb-2 p-3 rounded-lg flex justify-between items-center border-b-2 border-orange-500">
        <div class="flex items-center gap-4">
            <h1 class="text-xl font-black text-blue-900">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
            <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø­Ø«..." class="filter-select w-64 border-blue-200">
        </div>
        
        <div class="flex gap-2">
            <a href="join.html" class="bg-orange-500 text-white px-4 py-1.5 rounded text-xs font-bold hover:bg-orange-600 transition shadow-sm">
                â• Ø§Ù†Ø¶Ù…Ø§Ù… Ù…ÙƒØªØ¨Ø©
            </a>
            <div id="stats" class="text-[10px] bg-blue-50 text-blue-800 px-3 py-1.5 rounded border border-blue-100 font-bold">
                Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...
            </div>
        </div>
    </div>

    <div class="scroll-container shadow-inner rounded border border-gray-200">
        <table class="w-full text-right border-collapse">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¨Ø§Ø­Ø«</th>
                    <th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                    <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                    <th>Ø§Ù„Ø³Ù†Ø©</th>
                    <th>Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ù‚ØªÙ†ÙŠØ©</th>
                    <th>Ø§Ù„ØªÙˆØ§ØµÙ„</th>
                </tr>
            </thead>
            <tbody id="thesesBody">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            projectId: "libyan-theses-portal",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ø¬Ù„Ø¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠØ© ÙˆØ§Ù„Ù…ÙƒØªØ¨Ø§Øª Ù…Ø¹Ø§Ù‹
        function loadData() {
            db.ref('theses').on('value', (snapshot) => {
                const theses = [];
                snapshot.forEach(child => theses.push(child.val()));
                
                db.ref('library_requests').push(data)
                    const libs = {};
                    libSnap.forEach(lc => {
                        const lData = lc.val();
                        if(lData.status === 'active') libs[lData.name] = lData;
                    });
                    renderTable(theses, libs);
                });
            });
        }

        function renderTable(data, libs) {
            const tbody = document.getElementById('thesesBody');
            tbody.innerHTML = data.map(t => {
                const libInfo = libs[t.library] || null;
                return `
                <tr>
                    <td class="font-bold">${t.author || '-'}</td>
                    <td class="text-blue-900">${t.title || '-'}</td>
                    <td>${t.uni || '-'}</td>
                    <td class="text-center">${t.degree || '-'}</td>
                    <td class="text-center">${t.year || '-'}</td>
                    <td class="font-bold text-orange-700">${t.library || '-'}</td>
                    <td>
                        ${libInfo ? `<a href="tel:${libInfo.phone}" class="text-green-600">ğŸ“ Ø§ØªØµÙ„</a>` : '<span class="text-gray-400">ØºÙŠØ± Ù…ØªÙˆÙØ±</span>'}
                    </td>
                </tr>`;
            }).join('');
            document.getElementById('stats').innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${data.length}`;
        }

        loadData();
    </script>
</body>
</html>
