<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªØ¹Ø±Ø§Ø¶ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: #f8fafc; overflow: hidden; }
        .filter-select { padding: 4px; border-radius: 4px; border: 1px solid #cbd5e1; font-size: 11px; background: white; outline: none; min-width: 120px; }
        th { background-color: #1e3a8a; color: white; font-weight: bold; font-size: 11px; padding: 6px; position: sticky; top: 0; border: 1px solid #1e40af; }
        td { font-size: 11px; border-bottom: 1px solid #e2e8f0; padding: 4px; border-left: 1px solid #f1f5f9; }
        tr:hover { background-color: #f1f5f9; }
        .scroll-container { height: calc(100vh - 80px); overflow-y: auto; }
    </style>
</head>
<body class="p-2">

    <div class="bg-white shadow-sm rounded border-r-4 border-blue-800 p-2 mb-2">
        <div class="flex flex-wrap items-center gap-2">
            <h1 class="text-xs font-bold text-blue-900 ml-2">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
            
            <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø£Ùˆ Ø§Ù„Ù…Ø´Ø±Ù..." class="filter-select w-64 border-blue-200 focus:border-blue-500">
            
            <select id="uniFilter" class="filter-select"><option value="">ÙƒÙ„ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</option></select>
            <select id="collegeFilter" class="filter-select"><option value="">ÙƒÙ„ Ø§Ù„ÙƒÙ„ÙŠØ§Øª</option></select>
            <select id="yearFilter" class="filter-select"><option value="">ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª</option></select>
            
            <div id="stats" class="text-[10px] text-blue-700 mr-auto font-bold bg-blue-50 px-2 py-1 rounded">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        </div>
    </div>

    <div class="bg-white shadow rounded overflow-hidden scroll-container">
        <table class="w-full text-right border-collapse">
            <thead>
                <tr>
                    <th class="w-[12%]">Ø§Ù„Ø¨Ø§Ø­Ø«</th>
                    <th class="w-[20%]">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                    <th class="w-[12%]">Ø§Ù„Ù…Ø´Ø±Ù</th>
                    <th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                    <th>Ø§Ù„ÙƒÙ„ÙŠØ©</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th class="w-14 text-center">Ø§Ù„Ø³Ù†Ø©</th>
                    <th class="w-20 text-center">Ø§Ù„Ø±Ù‚Ù…</th>
                    <th class="w-16 text-center">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th class="w-10 text-center">ğŸ”—</th>
                    <th class="w-[12%]">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="thesesBody">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            projectId: "libyan-theses-portal",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allTheses = [];

        // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('theses').on('value', (snapshot) => {
            allTheses = [];
            if (snapshot.exists()) {
                snapshot.forEach(child => {
                    allTheses.push({ key: child.key, ...child.val() });
                });
                updateDropdowns();
                applyFilters();
            } else {
                document.getElementById('thesesBody').innerHTML = '<tr><td colspan="11" class="text-center py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>';
                document.getElementById('stats').innerText = "0 Ø±Ø³Ø§Ù„Ø©";
            }
        });

        function updateDropdowns() {
            const unis = [...new Set(allTheses.map(t => t.uni || t["Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©"]))].filter(Boolean).sort();
            const colleges = [...new Set(allTheses.map(t => t.college || t["Ø§Ù„ÙƒÙ„ÙŠØ©"]))].filter(Boolean).sort();
            const years = [...new Set(allTheses.map(t => t.year || t["Ø§Ù„Ø³Ù†Ø©"]))].filter(Boolean).sort((a,b)=>b-a);
            
            document.getElementById('uniFilter').innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</option>' + unis.map(u => `<option value="${u}">${u}</option>`).join('');
            document.getElementById('collegeFilter').innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„ÙƒÙ„ÙŠØ§Øª</option>' + colleges.map(c => `<option value="${c}">${c}</option>`).join('');
            document.getElementById('yearFilter').innerHTML = '<option value="">ÙƒÙ„ Ø§Ù„Ø³Ù†ÙˆØ§Øª</option>' + years.map(y => `<option value="${y}">${y}</option>`).join('');
        }

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const uni = document.getElementById('uniFilter').value;
            const college = document.getElementById('collegeFilter').value;
            const year = document.getElementById('yearFilter').value;

            const filtered = allTheses.filter(t => {
                const textMatch = (t.author + t.title + t.sup + (t["Ø§Ù„Ø¨Ø§Ø­Ø«"]||"") + (t["Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"]||"") + (t["Ø§Ù„Ù…Ø´Ø±Ù"]||"")).toLowerCase().includes(search);
                return textMatch && 
                       (uni === "" || (t.uni || t["Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©"]) === uni) &&
                       (college === "" || (t.college || t["Ø§Ù„ÙƒÙ„ÙŠØ©"]) === college) &&
                       (year === "" || (t.year || t["Ø§Ù„Ø³Ù†Ø©"]).toString() === year);
            });

            renderTable(filtered);
            document.getElementById('stats').innerText = `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ${filtered.length}`;
        }

        function renderTable(data) {
            const tbody = document.getElementById('thesesBody');
            tbody.innerHTML = data.map(t => `
                <tr>
                    <td class="font-bold text-gray-700">${t.author || t["Ø§Ù„Ø¨Ø§Ø­Ø«"] || '-'}</td>
                    <td class="text-blue-900 font-medium">${t.title || t["Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"] || '-'}</td>
                    <td class="text-gray-600">${t.sup || t["Ø§Ù„Ù…Ø´Ø±Ù"] || '-'}</td>
                    <td>${t.uni || t["Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©"] || '-'}</td>
                    <td>${t.college || t["Ø§Ù„ÙƒÙ„ÙŠØ©"] || '-'}</td>
                    <td>${t.dept || t["Ø§Ù„Ù‚Ø³Ù…"] || '-'}</td>
                    <td class="text-center font-mono">${t.year || t["Ø§Ù„Ø³Ù†Ø©"] || '-'}</td>
                    <td class="text-center text-gray-500 font-mono">${t.id || t["Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©"] || '-'}</td>
                    <td class="text-center">
                        <span class="px-1.5 py-0.5 rounded text-[9px] ${ (t.status || t["Ø§Ù„Ø­Ø§Ù„Ø©"]) === 'Ù…ØªÙˆÙØ±Ø©' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                            ${t.status || t["Ø§Ù„Ø­Ø§Ù„Ø©"] || '-'}
                        </span>
                    </td>
                    <td class="text-center">
                        ${(t.link || t["Ø§Ù„Ø±Ø§Ø¨Ø·"]) ? `<a href="${t.link || t["Ø§Ù„Ø±Ø§Ø¨Ø·"]}" target="_blank" class="text-blue-500 hover:underline">ğŸ”—</a>` : '-'}
                    </td>
                    <td class="text-gray-400 italic text-[10px] truncate max-w-[100px]" title="${t.notes || t["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"] || ''}">${t.notes || t["Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª"] || '-'}</td>
                </tr>
            `).join('');
        }

        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('uniFilter').addEventListener('change', applyFilters);
        document.getElementById('collegeFilter').addEventListener('change', applyFilters);
        document.getElementById('yearFilter').addEventListener('change', applyFilters);
    </script>
</body>
</html>
