<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>طلب انضمام | الفهرس الليبي الموحد</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: sans-serif; font-size: 12px; }
        .form-card { background: white; max-width: 500px; margin: 20px auto; padding: 20px; border-radius: 8px; shadow: 0 4px 6px rgba(0,0,0,0.1); border-top: 6px solid #1e3a8a; }
        input, select { width: 100%; padding: 8px; margin-top: 4px; margin-bottom: 12px; border: 1px solid #cbd5e1; border-radius: 4px; display: block; }
        label { font-weight: bold; color: #1e3a8a; }
        .btn-submit { background-color: #1e3a8a; color: white; width: 100%; padding: 10px; border-radius: 4px; font-weight: bold; cursor: pointer; border: none; }
        .btn-submit:hover { background-color: #000; }
    </style>
</head>
<body>

    <div class="form-card">
        <h2 class="text-center text-lg font-bold text-blue-900 mb-4 border-b pb-2">نموذج طلب انضمام مكتبة</h2>
        <form id="joinForm">
            <label>اسم المكتبة الكامل</label>
            <input type="text" id="libraryName" placeholder="مثلاً: مكتبة كلية الزراعة" required>

            <label>المدينة</label>
            <input type="text" id="city" placeholder="مثلاً: طرابلس" required>

            <label>التبعية (الجامعة / المركز)</label>
            <input type="text" id="affiliation" placeholder="مثلاً: جامعة طرابلس" required>

            <label>رقم هاتف للتواصل</label>
            <input type="tel" id="phone" placeholder="09XXXXXXXX" required>

            <label>رابط الموقع على الخريطة (Google Maps)</label>
            <input type="url" id="location" placeholder="https://goo.gl/maps/..." required>

            <button type="submit" class="btn-submit">إرسال طلب الانضمام</button>
        </form>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
        authDomain: "libyan-theses-portal.firebaseapp.com",
        projectId: "libyan-theses-portal",
        databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
        appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    document.getElementById('joinForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const newLibrary = {
            libraryName: document.getElementById('libraryName').value,
            city: document.getElementById('city').value,
            affiliation: document.getElementById('affiliation').value,
            phone: document.getElementById('phone').value,
            location: document.getElementById('location').value,
            requestDate: new Date().toLocaleString('ar-LY'),
            status: 'pending'
        };

        // الإرسال إلى المسار الموحد libraries_directory
        const newRef = db.ref('libraries_directory').push();
        newRef.set(newLibrary)
            .then(() => {
                alert("تم إرسال طلبك بنجاح! سيتم مراجعته من قبل الإدارة.");
                document.getElementById('joinForm').reset();
            })
            .catch((error) => {
                alert("حدث خطأ أثناء الإرسال: " + error.message);
            });
    });
</script>
</body>
</html>
