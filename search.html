<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© | Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-size: 12px; background-color: #f8fafc; font-family: sans-serif; padding: 10px; }
        .search-card { background: white; border-radius: 8px; shadow: 0 4px 6px rgba(0,0,0,0.05); border-top: 4px solid #1e3a8a; margin-bottom: 10px; padding: 15px; }
        input, select { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 5px; outline: none; font-size: 12px; }
        input:focus { border-color: #1e3a8a; box-shadow: 0 0 0 2px rgba(30,58,138,0.1); }
        th { background: #1e3a8a; color: white; padding: 8px; border: 1px solid #cbd5e1; position: sticky; top: 0; }
        td { padding: 6px; border: 1px solid #e2e8f0; text-align: center; background: white; }
        tr:nth-child(even) td { background: #f1f5f9; }
        .status-badge { padding: 2px 6px; border-radius: 10px; font-size: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="text-center mb-4">
        <h1 class="text-2xl font-bold text-blue-900">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</h1>
        <p class="text-gray-600 text-xs">Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</p>
    </div>

    <div class="search-card">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
            <div class="md:col-span-2">
                <input type="text" id="mainSearch" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¨Ø§Ø­Ø«ØŒ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†ØŒ Ø£Ùˆ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©..." onkeyup="searchTheses()">
            </div>
            <div>
                <select id="filterUni" onchange="searchTheses()">
                    <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</option>
                    </select>
            </div>
            <div>
                <select id="filterDeg" onchange="searchTheses()">
                    <option value="">ÙƒÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</option>
                    <option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                    <option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option>
                </select>
            </div>
        </div>
        <div class="text-left mt-2 text-[10px] text-gray-500" id="resultCount">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    </div>

    <div class="bg-white rounded shadow overflow-hidden">
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th class="w-1/4 text-right pr-4">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¨Ø§Ø­Ø«</th>
                    <th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th>
                    <th>Ø§Ù„Ø³Ù†Ø©</th>
                    <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ù…Ø³ØªÙ†Ø¯</th>
                </tr>
            </thead>
            <tbody id="publicTableBody">
                </tbody>
        </table>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
        authDomain: "libyan-theses-portal.firebaseapp.com",
        projectId: "libyan-theses-portal",
        databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
        appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let allData = [];

    // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹
    db.ref('theses_data').on('value', (snap) => {
        allData = [];
        const unis = new Set();
        snap.forEach(child => {
            const v = child.val();
            allData.push(v);
            if(v.university) unis.add(v.university);
        });
        
        // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª
        const uniSelect = document.getElementById('filterUni');
        unis.forEach(u => {
            const opt = document.createElement('option');
            opt.value = opt.text = u;
            uniSelect.add(opt);
        });
        
        displayData(allData);
    });

    function displayData(data) {
        const tbody = document.getElementById('publicTableBody');
        tbody.innerHTML = '';
        data.forEach(v => {
            tbody.innerHTML += `
                <tr>
                    <td class="text-right pr-4 font-bold text-blue-900">${v.title || '-'}</td>
                    <td class="text-blue-700">${v.author || '-'}</td>
                    <td>${v.university || '-'}</td>
                    <td>${v.year || '-'}</td>
                    <td>${v.degree || '-'}</td>
                    <td class="font-mono text-gray-500">${v.serialNum || '-'}</td>
                    <td>
                        ${v.link ? `<a href="${v.link}" target="_blank" class="text-blue-600 underline font-bold">Ø¹Ø±Ø¶</a>` : '<span class="text-gray-400">ØºÙŠØ± Ù…ØªÙˆÙØ±</span>'}
                    </td>
                </tr>
            `;
        });
        document.getElementById('resultCount').innerText = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.length} Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù…ÙŠØ©`;
    }

    function searchTheses() {
        const query = document.getElementById('mainSearch').value.toLowerCase();
        const uni = document.getElementById('filterUni').value;
        const deg = document.getElementById('filterDeg').value;

        const filtered = allData.filter(v => {
            const textMatch = (v.title + v.author + v.supervisor + v.serialNum).toLowerCase().includes(query);
            const uniMatch = uni === "" || v.university === uni;
            const degMatch = deg === "" || v.degree === deg;
            return textMatch && uniMatch && degMatch;
        });

        displayData(filtered);
    }
</script>
</body>
</html>
