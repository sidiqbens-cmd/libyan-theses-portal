<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… | Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-size: 11px; background-color: #f1f5f9; font-family: sans-serif; }
        th { background: #1e3a8a; color: white; padding: 6px; border: 1px solid #475569; text-align: center; }
        td { padding: 6px; border: 1px solid #cbd5e1; text-align: center; background: white; }
        .btn-approve { background-color: #16a34a; color: white; padding: 4px 8px; rounded: 2px; font-weight: bold; }
        .btn-delete { background-color: #dc2626; color: white; padding: 4px 8px; rounded: 2px; font-weight: bold; margin-right: 4px; }
    </style>
</head>
<body class="p-2">

    <div class="flex justify-between items-center mb-2 bg-white p-3 border border-slate-300">
        <h1 class="text-blue-900 font-bold text-sm italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h1>
        <div id="stats" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-xs font-bold">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª...</div>
    </div>

    <div class="overflow-x-auto main-card border border-slate-300">
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th>Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø©</th>
                    <th>Ø§Ù„ØªØ¨Ø¹ÙŠØ©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="requestsTableBody">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc", 
            authDomain: "libyan-theses-portal.firebaseapp.com", 
            projectId: "libyan-theses-portal", 
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app", 
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc" 
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadRequests() {
            db.ref('join_requests').on('value', snap => {
                const tbody = document.getElementById('requestsTableBody');
                const stats = document.getElementById('stats');
                tbody.innerHTML = '';
                
                if (!snap.exists()) {
                    tbody.innerHTML = '<tr><td colspan="6" class="p-4 text-gray-500 text-sm">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù†Ø¶Ù…Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>';
                    stats.innerText = '0 Ø·Ù„Ø¨Ø§Øª Ø§Ù†ØªØ¸Ø§Ø±';
                    return;
                }

                let count = 0;
                snap.forEach(child => {
                    const v = child.val();
                    const key = child.key;
                    count++;
                    
                    // Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù…Ø³Ù…ÙŠØ§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Firebase Ù„Ø¯ÙŠÙƒ
                    tbody.innerHTML += `<tr>
                        <td class="font-bold text-blue-900 text-right px-4">${v.libName || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…'}</td>
                        <td>${v.affiliation || '-'}</td>
                        <td>${v.contact || '-'}</td>
                        <td>${v.phone || '-'}</td>
                        <td>
                            ${v.map ? `<a href="${v.map}" target="_blank" class="text-blue-600 font-bold underline">Ø®Ø±ÙŠØ·Ø© ğŸ“</a>` : '-'}
                        </td>
                        <td>
                            <button onclick="deleteRequest('${key}')" class="btn-delete">Ø­Ø°Ù</button>
                        </td>
                    </tr>`;
                });
                stats.innerText = `${count} Ø·Ù„Ø¨Ø§Øª Ø§Ù†ØªØ¸Ø§Ø±`;
            });
        }

        function deleteRequest(key) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                db.ref('join_requests/' + key).remove()
                .then(() => alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…"))
                .catch(err => alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù: " + err.message));
            }
        }

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        loadRequests();
    </script>
</body>
</html>
