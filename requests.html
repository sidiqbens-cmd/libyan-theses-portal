<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… | Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { font-size: 11px; background-color: #f1f5f9; font-family: sans-serif; }
        th { background: #1e3a8a; color: white; padding: 6px; border: 1px solid #475569; text-align: center; }
        td { padding: 6px; border: 1px solid #cbd5e1; text-align: center; background: white; }
        .btn-del { background-color: #dc2626; color: white; padding: 3px 8px; border-radius: 2px; font-weight: bold; }
    </style>
</head>
<body class="p-2">

    <div class="flex justify-between items-center mb-2 bg-white p-3 border border-slate-300">
        <h1 class="text-blue-900 font-bold text-sm italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ø¥Ø¯Ø§Ø±Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</h1>
        <div id="stats" class="bg-blue-100 text-blue-800 px-3 py-1 rounded text-xs font-bold italic">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <div class="overflow-x-auto border border-slate-300 shadow-sm">
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th class="w-1/4 text-right pr-4 italic">Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØªØ¨Ø©</th>
                    <th>Ø§Ù„ØªØ¨Ø¹ÙŠØ©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                    <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="requestsTableBody">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc", 
            authDomain: "libyan-theses-portal.firebaseapp.com", 
            projectId: "libyan-theses-portal", 
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app", 
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc" 
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadRequests() {
            db.ref('join_requests').on('value', snap => {
                const tbody = document.getElementById('requestsTableBody');
                const stats = document.getElementById('stats');
                tbody.innerHTML = '';
                
                if (!snap.exists()) {
                    tbody.innerHTML = '<tr><td colspan="7" class="p-10 text-gray-400 text-sm italic">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø§Ù†Ø¶Ù…Ø§Ù… Ø¬Ø¯ÙŠØ¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</td></tr>';
                    stats.innerText = '0 Ø·Ù„Ø¨Ø§Øª Ø§Ù†ØªØ¸Ø§Ø±';
                    return;
                }

                let count = 0;
                snap.forEach(child => {
                    const v = child.val();
                    const key = child.key;
                    count++;
                    
                    tbody.innerHTML += `<tr>
                        <td class="font-bold text-blue-900 text-right pr-4">${v.libName || '-'}</td>
                        <td class="font-bold text-slate-600">${v.affiliation || '-'}</td>
                        <td>${v.contact || '-'}</td>
                        <td dir="ltr" class="font-bold text-blue-800">${v.phone || '-'}</td>
                        <td>${v.email || '-'}</td>
                        <td>
                            ${v.map ? `<a href="${v.map}" target="_blank" class="text-blue-600 font-bold underline">ÙØªØ­ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ğŸ“</a>` : '-'}
                        </td>
                        <td>
                            <button onclick="deleteRequest('${key}')" class="btn-del hover:bg-red-700 transition">Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨</button>
                        </td>
                    </tr>`;
                });
                stats.innerText = `${count} Ø·Ù„Ø¨Ø§Øª Ø§Ù†ØªØ¸Ø§Ø±`;
            });
        }

        function deleteRequest(key) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
                db.ref('join_requests/' + key).remove()
                .then(() => alert("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­ âœ…"));
            }
        }

        loadRequests();
    </script>
</body>
</html>
