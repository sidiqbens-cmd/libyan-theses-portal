    <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุฅุฏุงุฑุฉ ุงูุทูุจุงุช | ุจูุงุจุฉ ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ ุงูููุจูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="p-4 bg-slate-900 text-[12px] font-sans text-slate-300">

    <div class="flex justify-between items-center mb-4 bg-slate-800 p-4 border border-slate-700 rounded-xl shadow-lg">
        <div>
            <h1 class="text-white font-black text-lg italic">ุจูุงุจุฉ ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ ุงูููุจูุฉ | ุฅุฏุงุฑุฉ ุทูุจุงุช ุงูุงูุถูุงู</h1>
            <p class="text-sky-400 text-[10px] font-bold uppercase tracking-widest">ุชุฌููุฒ ุงูุจูุงูุงุช ููุนุฑุถ ุงูุนุงู</p>
        </div>
        <div id="stats" class="bg-sky-500/10 text-sky-400 px-4 py-2 rounded-lg border border-sky-500/20 font-black">ุฌุงุฑู ุงููุฒุงููุฉ...</div>
    </div>

    <div class="overflow-hidden border border-slate-700 rounded-xl shadow-2xl bg-slate-800">
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-slate-700 text-sky-400">
                    <th class="p-3 border-b border-slate-600 text-right">ุงููุคุณุณุฉ ูุงููุฏููุฉ</th>
                    <th class="p-3 border-b border-slate-600 text-right">ุงููุณุคูู ูุงูุชุจุนูุฉ</th>
                    <th class="p-3 border-b border-slate-600 text-center">ุงูุฑูุงุจุท ูุงูุงุชุตุงู</th>
                    <th class="p-3 border-b border-slate-600 text-center">ุงูุฅุฌุฑุงุก</th>
                </tr>
            </thead>
            <tbody id="requestsTableBody" class="text-right">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = { 
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadData() {
            db.ref('join_requests').on('value', snap => {
                const tbody = document.getElementById('requestsTableBody');
                tbody.innerHTML = '';
                let count = 0;
                snap.forEach(child => {
                    const v = child.val();
                    const key = child.key;
                    count++;
                    
                    // ูุญุต ูุฌูุฏ ุงูุฑูุงุจุท ูุนุฑุถ ุฃููููุงุช ุชูุถูุญูุฉ ูููุดุฑู
                    const hasSocial = (v.facebook || v.website) ? '๐' : 'โช';
                    const hasMap = v.map ? '๐' : 'โ';

                    tbody.innerHTML += `
                        <tr class="hover:bg-slate-700/50 transition-colors border-b border-slate-700/50">
                            <td class="p-3 text-white font-bold">
                                ${v.libName || '-'} 
                                <span class="block text-[10px] text-slate-500 font-normal">${v.city || 'ููุจูุง'} ${hasMap}</span>
                            </td>
                            <td class="p-3">
                                <span class="text-slate-200 block">${v.contact || v.contact || '-'}</span> 
                                <span class="text-[10px] text-sky-500 font-bold">${v.affiliation || 'ุฌุงูุนุฉ ููุจูุฉ'}</span>
                            </td>
                            <td class="p-3 text-center">
                                <div class="text-blue-400">${v.email || '-'}</div>
                                <div class="text-[10px] text-slate-500">${v.phone || '-'} | ${hasSocial}</div>
                            </td>
                            <td class="p-3 text-center">
                                <button onclick="approveRequest('${key}')" class="bg-emerald-600 text-white px-3 py-1.5 rounded-lg font-bold hover:bg-emerald-500 transition-all shadow-lg">โ ุงุนุชูุงุฏ</button>
                                <button onclick="del('${key}')" class="bg-red-500/10 text-red-500 px-3 py-1.5 rounded-lg font-bold mr-2 hover:bg-red-500 hover:text-white transition-all">ุญุฐู</button>
                            </td>
                        </tr>`;
                });
                document.getElementById('stats').innerText = `${count} ุทูุจุงุช ุจุงูุชุธุงุฑ ุงูุณูุทุฑุฉ`;
            });
        }

        async function approveRequest(key) {
            const snap = await db.ref('join_requests/' + key).once('value');
            const v = snap.val();
            if(!v) return;

            // ุชูููุฏ ูููุฉ ูุฑูุฑ ุนุดูุงุฆูุฉ ููููุชุจุฉ
            const pass = "Libya@" + Math.floor(1000 + Math.random() * 9000);
            
            if(confirm(`ูู ุชุฑูุฏ ุงุนุชูุงุฏ "${v.libName}"ุ\nุณูุชู ููู ูุงูุฉ ุงูุจูุงูุงุช (ุจูุง ูููุง ุณุงุนุงุช ุงูุนูู ูุงูุฑูุงุจุท) ุฅูู ุณุฌู ุงูููุชุจุงุช ุงููุนุชูุฏุฉ.`)) {
                
               // ุชุฌููุน ุงูุจูุงูุงุช ุงููุงููุฉ ูู ุงููููุฐุฌ ูุถูุงู ุงููุทุงุจูุฉ ุงูุชุงูุฉ
            const approvedData = {
                libName: v.libName || "",       // ุงุณู ุงูููุชุจุฉ ุงูุฑุณูู
                affiliation: v.affiliation || "", // ุงูุชุจุนูุฉ (ุฌุงูุนุฉ/ูุฒุงุฑุฉ)
                manager: v.contact || "", // ุงููุณุคูู ุนู ุงูุชูุงุตู
                phone: v.phone || "",           // ุฑูู ุงููุงุชู
                email: v.email || "",           // ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
                city: v.city || "",             // ุงููุฏููุฉ
                hours: v.hours || "ูู ุงูุฃุญุฏ ุฅูู ุงูุฎููุณ (09:00 ุต - 02:00 ุธ)", // ููุงุนูุฏ ุงูุนูู
                map: v.map || "", // ุฑุงุจุท ุฎุฑุงุฆุท ุฌูุฌู
                facebook: v.facebook || "",     // ุฑุงุจุท ููุณุจูู
                website: v.website || "",       // ุงููููุน ุงูุฅููุชุฑููู
                password: pass,                 // ูููุฉ ุงููุฑูุฑ ุงููููุฏุฉ
                dateApproved: new Date().toLocaleDateString('ar-LY'),
                status: "approved"
            };

            // ููู ุงูุจูุงูุงุช ุฅูู ุงูุณุฌู ุงูุฏุงุฆู
            await db.ref('approved_libraries/' + key).set(approvedData);
                
                // 2. ุฅุฒุงูุฉ ุงูุทูุจ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ (Move)
                await db.ref('join_requests/' + key).remove();

// ุชุญุถูุฑ ูุต ุงูุฑุณุงูุฉ ุจุดูู ุณููู
                const msg = `ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชูุ

ุฅูู ุฅุฏุงุฑุฉ ุงูููุชุจุฉ ุงููููุฑุฉุ

ูุณุฑูุง ุฅุจูุงุบูู ุจุฃูู ูุฏ ุชู ุงุนุชูุงุฏ ุทูุจ ุงูุถูุงู ููุชุจุชูู ุฅูู "ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ" ุจูุฌุงุญ.

ุจุฅููุงููู ุงูุขู ุงูุจุฏุก ูู ุฑูุน ุจูุงูุงุช ุงูุฑุณุงุฆู ุงูุฎุงุตุฉ ุจููุชุจุชูู ุนุจุฑ ุงูุฑุงุจุท ุงูุชุงูู:
https://sidiqbens-cmd.github.io/libyan-theses-portal/lib-dashboard.html

ูุฑุฌู ุงุณุชุฎุฏุงู ุจูุงูุงุช ุงูุฏุฎูู ุงููุนุชูุฏุฉ ุงูุชุงููุฉ:
โข ุงูุจุฑูุฏ ุงูุฅููุชุฑููู: ${v.email}
โข ูููุฉ ุงููุฑูุฑ: ${pass}

ุดุงูุฑูู ููู ุญุณู ุชุนุงููููุ
ุฅุฏุงุฑุฉ ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ`;

                // ุงูุญู ุงูุฌุฐุฑู ููุดููุฉ ุงูุญุฑูู ุบูุฑ ุงููุงุถุญุฉ
                const encodedSubject = encodeURIComponent("ุฅุดุนุงุฑ ุงุนุชูุงุฏ ุงูุถูุงู - ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ");
                const encodedBody = encodeURIComponent(msg);
                
                // 1. ุชุญุถูุฑ ูุต ุงูุฑุณุงูุฉ (ุงุณุชุฎุฏุงู emailBody)
                const emailBody = `ุงูุณูุงู ุนูููู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชูุ
                
ุฅูู ุฅุฏุงุฑุฉ ุงูููุชุจุฉ ุงููููุฑุฉุ
ุชู ุงุนุชูุงุฏ ุทูุจูู ูู "ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ" ุจูุฌุงุญ.

ุจูุงูุงุช ุงูุฏุฎูู:
โข ุงูุฅูููู: ${v.email}
โข ูููุฉ ุงููุฑูุฑ: ${pass}

ุงูุฑุงุจุท: https://sidiqbens-cmd.github.io/libyan-theses-portal/lib-dashboard.html

ุฅุฏุงุฑุฉ ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ`;

                // 2. ุฅุธูุงุฑ ูุงูุฐุฉ ููุจุซูุฉ ุงุญุชูุงุทูุฉ (ุชุธูุฑ ุฏุงุฆูุงู ุจุญุฑูู ุณูููุฉ)
                alert("โ๏ธ ุชู ุงูุงุนุชูุงุฏ ุจูุฌุงุญ!\n\nูุฑุฌู ูุณุฎ ุจูุงูุงุช ุงูุฏุฎูู ูุฅุฑุณุงููุง ูู ุญุงู ุนุฏู ูุถูุญ ุงูุฅูููู:\n" + emailBody);

                // 3. ูุชุญ ุงูุฅูููู ุจุชุดููุฑ ุณููู 100%
                const encodedSubject = encodeURIComponent("ุฅุดุนุงุฑ ุงุนุชูุงุฏ ุงูุถูุงู - ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ");
                const encodedBody = encodeURIComponent(emailBody);
                window.location.href = `mailto:${v.email}?subject=${encodedSubject}&body=${encodedBody}`;

                loadData(); // ุชุญุฏูุซ ุงูุฌุฏูู ููุฑุงู
    }
}

        // ุฏุงูุฉ ุญุฐู ุงูุทูุจุงุช
    function del(key) {
        if(confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุทูุจ ููุงุฆูุงูุ")) {
            db.ref('join_requests/' + key).remove();
        }
    }

// ุชุดุบูู ุฌูุจ ุงูุจูุงูุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ
window.onload = loadData;
</script>
</body>
</html
