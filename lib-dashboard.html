<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>دخول المكتبة | الفهرس الليبي الموحد</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="bg-[#020617] min-h-screen flex items-center justify-center p-4">

    <div id="loginArea" class="w-full max-w-md bg-[#1e293b]/50 backdrop-blur-xl p-8 rounded-[2.5rem] border border-slate-700 shadow-2xl">
        <div class="text-center mb-8">
            <h1 class="text-2xl font-black text-white italic">تسجيل دخول المكتبة</h1>
            <p class="text-sky-400 text-[10px] font-bold uppercase tracking-widest mt-2">بوابة رفع البيانات المعتمدة</p>
        </div>
        
        <div class="space-y-4">
            <input type="email" id="libEmail" placeholder="البريد الإلكتروني المعتمد" 
                   class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl text-white outline-none focus:border-sky-500 transition-all font-bold">
            
            <input type="password" id="libPass" placeholder="كلمة المرور" 
                   class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl text-white outline-none focus:border-sky-500 transition-all font-bold">
            
            <button onclick="login()" class="w-full bg-[#0ea5e9] text-white py-4 rounded-2xl font-black text-lg hover:bg-sky-400 transition-all shadow-lg">
                دخول للوحة الرفع
            </button>
        </div>
    </div>

    <script>
        // إعدادات Firebase
        const firebaseConfig = { 
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app" 
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentLib = null;

        // وظيفة تسجيل الدخول والتوجيه
        async function login() {
            const email = document.getElementById('libEmail').value;
            const pass = document.getElementById('libPass').value;

            if(!email || !pass) {
                alert("يرجى إدخال البريد وكلمة المرور");
                return;
            }

            // البحث في سجل المكتبات المعتمدة
            const snap = await db.ref('approved_libraries').once('value');
            let found = false;
            
            snap.forEach(child => {
                const lib = child.val();
                if(lib.email === email && lib.password === pass) {
                    currentLib = { id: child.key, ...lib };
                    found = true;
                }
            });

            if(found) {
                // حفظ بيانات المكتبة في الجلسة لاستخدامها في صفحة الرفع
                sessionStorage.setItem('authenticatedLib', JSON.stringify(currentLib));
                
                // التوجيه إلى صفحة الرفع الجاهزة لديك (upload.html)
                window.location.href = 'upload.html';
            } else {
                alert("بيانات الدخول غير صحيحة أو لم يتم اعتماد مكتبتكم بعد.");
            }
        }
    </script>
</body>
</html>
