<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #0f172a; color: #e2e8f0; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; padding: 10px; }
        
        /* ØªÙƒØ¨ÙŠØ± Ø¬Ù…Ù„Ø© Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© ÙˆØ­Ø°Ù Ø§Ù„Ø²ÙˆØ§Ø¦Ø¯ */
        .portal-title-giant { font-size: 52px; font-weight: 900; color: white; line-height: 1; text-shadow: 0 0 20px rgba(56, 189, 248, 0.3); }
        
        /* ØªØ¨Ø§Ø¹Ø¯ 1 Ø³Ù… Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± (ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ 38px) */
        .grid-gap-cm { gap: 38px; }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø¨Ø£Ù„ÙˆØ§Ù† Ø®Ø§ÙØªØ© Ø¬Ø¯Ø§Ù‹ */
        .soft-stat-card { background: rgba(30, 41, 59, 0.3); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 12px; padding: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: 0.3s; }
        .soft-stat-card b { @apply text-2xl text-sky-300; }
        .soft-stat-card span { @apply text-[10px] text-slate-500 font-bold uppercase; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³ÙˆÙ… - Ø­Ø¬Ù… Ø£ØµØºØ± ÙˆØªØ¨Ø§Ø¹Ø¯ */
        .chart-container { background: transparent; height: 160px; display: flex; flex-direction: column; align-items: center; }
        .chart-label { @apply text-[10px] font-bold text-slate-500 mt-2 uppercase tracking-widest; }

        /* Ø¬Ø¯ÙˆÙ„ Ø¢Ø®Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª (ØªÙ…Øª Ø¥Ø¹Ø§Ø¯ØªÙ‡) */
        .record-table { width: 100%; font-size: 11px; }
        .record-table th { @apply text-sky-500 border-b border-slate-700 pb-2 text-right; }
        .record-table td { @apply py-2 border-b border-slate-800/50 text-slate-300 truncate max-w-[200px]; }

        canvas { max-height: 130px !important; }
    </style>
</head>
<body>

    <div class="flex justify-between items-end mb-8 px-4">
        <div>
            <h1 class="portal-title-giant">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</h1>
            <p class="text-sky-500 font-bold tracking-[0.5em] mt-2 mr-2 text-xs uppercase">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙˆÙ„ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ø§Ù„ÙˆØ·Ù†ÙŠ</p>
        </div>
        <div class="text-left">
            <div id="live-clock" class="text-3xl font-mono font-black text-sky-400 opacity-80">00:00:00</div>
        </div>
    </div>

    <div class="flex gap-4 mb-8 px-4">
        <a href="upload.html" class="px-6 py-2 bg-sky-600/20 border border-sky-500/40 rounded-full text-xs font-bold text-sky-400 hover:bg-sky-500 hover:text-white transition-all">ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Excel)</a>
        <a href="approved_libraries.html" class="px-6 py-2 bg-slate-800 border border-slate-700 rounded-full text-xs font-bold text-slate-300 hover:border-sky-500 transition-all">ğŸ›ï¸ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</a>
        <a href="requests.html" class="px-6 py-2 bg-slate-800 border border-slate-700 rounded-full text-xs font-bold text-slate-300 hover:border-amber-500 transition-all">ğŸ“© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</a>
        <a href="index.html" class="px-6 py-2 bg-slate-800 border border-slate-700 rounded-full text-xs font-bold text-slate-300 hover:border-white transition-all">ğŸŒ Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</a>
    </div>

    <div class="grid grid-rows-2 grid-gap-cm flex-grow px-4 overflow-hidden">
        <div class="grid grid-cols-3 grid-gap-cm">
            <div class="chart-container"><canvas id="ch_degree"></canvas><span class="chart-label">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</span></div>
            <div class="chart-container"><canvas id="ch_year"></canvas><span class="chart-label">Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø²Ù…Ù†ÙŠ</span></div>
            <div class="chart-container"><canvas id="ch_uni"></canvas><span class="chart-label">Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</span></div>
        </div>
        
        <div class="grid grid-cols-12 grid-gap-cm h-full items-start">
            <div class="col-span-4 chart-container border-l border-slate-800 pl-8">
                <canvas id="ch_coll"></canvas>
                <span class="chart-label">Ø§Ù„ÙƒÙ„ÙŠØ§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ù†ØªØ§Ø¬Ø§Ù‹</span>
            </div>

            <div class="col-span-3 grid grid-cols-2 gap-3 h-fit">
                <div class="soft-stat-card"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><b id="s_total">0</b></div>
                <div class="soft-stat-card"><span>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</span><b id="s_unis">0</b></div>
                <div class="soft-stat-card"><span>Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span><b id="s_pending">0</b></div>
                <div class="soft-stat-card"><span>Ù…ÙƒØªØ¨Ø©</span><b id="s_libs">0</b></div>
            </div>

            <div class="col-span-5 h-full overflow-hidden">
                <div class="flex justify-between items-center border-b border-slate-700 mb-2 pb-1">
                    <span class="text-[10px] font-bold text-sky-500 uppercase">Ø¢Ø®Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</span>
                </div>
                <div class="overflow-y-auto max-h-[140px]">
                    <table class="record-table">
                        <tbody id="recentTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function loadDashboard() {
            db.ref('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø±Ø³Ø§Ø¦Ù„').on('value', snap => {
                let data = [], s = {deg:{}, yrs:{}, uni:{}, coll:{}};
                snap.forEach(c => {
                    let v = c.val(); data.push(v);
                    if(v.Ø§Ù„Ø¯Ø±Ø¬Ø©) s.deg[v.Ø§Ù„Ø¯Ø±Ø¬Ø©] = (s.deg[v.Ø§Ù„Ø¯Ø±Ø¬Ø©]||0)+1;
                    if(v.Ø§Ù„Ø³Ù†Ø©) s.yrs[v.Ø§Ù„Ø³Ù†Ø©] = (s.yrs[v.Ø§Ù„Ø³Ù†Ø©]||0)+1;
                    if(v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©) s.uni[v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©] = (s.uni[v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©]||0)+1;
                    if(v.Ø§Ù„ÙƒÙ„ÙŠØ©) s.coll[v.Ø§Ù„ÙƒÙ„ÙŠØ©] = (s.coll[v.Ø§Ù„ÙƒÙ„ÙŠØ©]||0)+1;
                });
                
                document.getElementById('s_total').innerText = data.length;
                document.getElementById('s_unis').innerText = Object.keys(s.uni).length;
                
                render(s);
                document.getElementById('recentTable').innerHTML = data.reverse().slice(0, 5).map(d => `
                    <tr><td class="font-bold text-sky-400">${d.Ø§Ù„Ø¨Ø§Ø­Ø« || 'Ø¨Ø§Ø­Ø«'}</td><td>${d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù†}</td><td class="text-[9px] opacity-50">${d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©}</td></tr>
                `).join('');
            });

            db.ref('libraries').on('value', snap => {
                let p = 0, a = 0; snap.forEach(c => { if(c.val().status === 'pending') p++; else a++; });
                document.getElementById('s_pending').innerText = p;
                document.getElementById('s_libs').innerText = a;
            });
        }

        function render(s) {
            Chart.defaults.color = '#475569';
            const opt = { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, font: { size: 9 } } } } };

            new Chart(document.getElementById('ch_degree'), { type: 'doughnut', data: { labels: Object.keys(s.deg), datasets: [{ data: Object.values(s.deg), backgroundColor: ['#0ea5e9', '#f59e0b'], borderWidth: 0 }] }, options: opt });
            new Chart(document.getElementById('ch_year'), { type: 'line', data: { labels: Object.keys(s.yrs), datasets: [{ label: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', data: Object.values(s.yrs), borderColor: '#10b981', fill: true, backgroundColor: 'rgba(16,185,129,0.05)', tension: 0.4 }] }, options: opt });
            new Chart(document.getElementById('ch_uni'), { type: 'pie', data: { labels: Object.keys(s.uni).slice(0, 5), datasets: [{ data: Object.values(s.uni).slice(0, 5), backgroundColor: ['#0ea5e9', '#6366f1', '#10b981', '#f59e0b', '#8b5cf6'], borderWidth: 0 }] }, options: opt });
            new Chart(document.getElementById('ch_coll'), { type: 'bar', data: { labels: Object.keys(s.coll).slice(0, 5), datasets: [{ label: 'Ø§Ù„ÙƒÙ„ÙŠØ©', data: Object.values(s.coll).slice(0, 5), backgroundColor: '#6366f1' }] }, options: opt });
        }

        setInterval(() => { document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-GB'); }, 1000);
        loadDashboard();
    </script>
</body>
</html>
