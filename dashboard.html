<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ© | Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', Tahoma, sans-serif; height: 100vh; overflow: hidden; padding: 8px; display: flex; flex-direction: column; }
        .main-header { background: white; padding: 12px; border-radius: 12px; border-bottom: 4px solid #1e3a8a; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        
        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø«Ù„Ø§Ø« Ø§Ù„Ø£ÙˆÙ„Ù‰ Ø¨ØªØ¯Ø±Ø¬Ø§Øª Ø£Ø®Ù */
        .card-1 { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 1px solid #bfdbfe; }
        .card-2 { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 1px solid #bbf7d0; }
        .card-3 { background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); border: 1px solid #fef08a; }
        .card-4 { background: white; border: 1px solid #e2e8f0; }

        .btn-action { @apply flex flex-col items-center justify-center p-2 rounded-xl transition-all hover:shadow-md active:scale-95 text-[10px] font-bold text-slate-700 border border-slate-200 bg-white; }
        .stat-num { @apply text-2xl font-black text-slate-800 block; }
        canvas { max-height: 160px !important; }
    </style>
</head>
<body>

    <div class="main-header shadow-sm">
        <div>
            <h1 class="text-xl font-black text-blue-900">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</h1>
            <p class="text-[10px] text-gray-500 font-bold">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„ÙƒØ§Ù…Ù„</p>
        </div>
        <div class="flex gap-2">
            <span id="live-clock" class="bg-slate-100 px-3 py-1 rounded-full text-[10px] font-mono text-slate-600 border italic">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
        </div>
    </div>

    <div class="grid grid-cols-6 gap-2 mb-3">
        <a href="index.html" class="btn-action hover:border-blue-500 hover:text-blue-600">
            <span class="text-lg mb-1">ğŸŒ</span> Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±
        </a>
        <a href="add_thesis.html" class="btn-action hover:border-emerald-500 hover:text-emerald-600">
            <span class="text-lg mb-1">â•</span> Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø©
        </a>
        <a href="requests.html" class="btn-action hover:border-amber-500 hover:text-amber-600">
            <span class="text-lg mb-1">ğŸ“©</span> Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…
        </a>
        <a href="libraries_mgt.html" class="btn-action hover:border-indigo-500 hover:text-indigo-600">
            <span class="text-lg mb-1">ğŸ›ï¸</span> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        </a>
        <button onclick="window.print()" class="btn-action hover:border-rose-500 hover:text-rose-600">
            <span class="text-lg mb-1">ğŸ–¨ï¸</span> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
        </button>
        <button onclick="location.reload()" class="btn-action hover:border-slate-400">
            <span class="text-lg mb-1">ğŸ”„</span> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
    </div>

    <div class="grid grid-cols-4 gap-3 mb-3 text-center">
        <div class="card-1 p-3 rounded-xl shadow-sm">
            <span class="text-[10px] uppercase font-bold text-blue-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
            <b id="total_theses" class="stat-num">-</b>
        </div>
        <div class="card-2 p-3 rounded-xl shadow-sm">
            <span class="text-[10px] uppercase font-bold text-emerald-600">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</span>
            <b id="total_unis" class="stat-num">-</b>
        </div>
        <div class="card-3 p-3 rounded-xl shadow-sm">
            <span class="text-[10px] uppercase font-bold text-amber-600">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</span>
            <b id="pending_libs" class="stat-num">-</b>
        </div>
        <div class="card-4 p-3 rounded-xl shadow-sm border-l-4 border-indigo-600">
            <span class="text-[10px] uppercase font-bold text-indigo-600">Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</span>
            <b id="total_libs" class="stat-num">-</b>
        </div>
    </div>

    <div class="grid grid-cols-3 gap-3 flex-grow">
        <div class="bg-white p-3 rounded-xl shadow-sm border border-slate-100 flex flex-col">
            <h3 class="text-[11px] font-black mb-2 text-slate-700 border-b pb-1">ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª (Ù…Ø§Ø¬Ø³ØªÙŠØ±/Ø¯ÙƒØªÙˆØ±Ø§Ù‡)</h3>
            <div class="flex-grow"><canvas id="degreeChart"></canvas></div>
        </div>
        <div class="bg-white p-3 rounded-xl shadow-sm border border-slate-100 flex flex-col">
            <h3 class="text-[11px] font-black mb-2 text-slate-700 border-b pb-1">Ù†Ù…Ùˆ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø­Ø³Ø¨ Ø§Ù„Ø³Ù†ÙˆØ§Øª</h3>
            <div class="flex-grow"><canvas id="yearChart"></canvas></div>
        </div>
        <div class="bg-white p-3 rounded-xl shadow-sm border border-slate-100 flex flex-col">
            <h3 class="text-[11px] font-black mb-2 text-slate-700 border-b pb-1">Ø£ÙƒØ«Ø± 5 Ø¬Ø§Ù…Ø¹Ø§Øª Ù…Ø³Ø§Ù‡Ù…Ø©</h3>
            <div class="flex-grow"><canvas id="uniChart"></canvas></div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function updateClock() {
            const now = new Date();
            document.getElementById('live-clock').innerText = "ğŸ“… " + now.toLocaleDateString('ar-LY') + " | ğŸ•’ " + now.toLocaleTimeString('ar-LY');
        }
        setInterval(updateClock, 1000);

        function loadStats() {
            db.ref('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø±Ø³Ø§Ø¦Ù„').on('value', snap => {
                let stats = { degree: {}, years: {}, unis: {} };
                let count = 0;
                snap.forEach(child => {
                    let d = child.val();
                    count++;
                    if(d.Ø§Ù„Ø¯Ø±Ø¬Ø©) stats.degree[d.Ø§Ù„Ø¯Ø±Ø¬Ø©] = (stats.degree[d.Ø§Ù„Ø¯Ø±Ø¬Ø©] || 0) + 1;
                    if(d.Ø§Ù„Ø³Ù†Ø©) stats.years[d.Ø§Ù„Ø³Ù†Ø©] = (stats.years[d.Ø§Ù„Ø³Ù†Ø©] || 0) + 1;
                    if(d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©) stats.unis[d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©] = (stats.unis[d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©] || 0) + 1;
                });
                document.getElementById('total_theses').innerText = count;
                document.getElementById('total_unis').innerText = Object.keys(stats.unis).length;
                renderCharts(stats);
            });

            db.ref('libraries').on('value', snap => {
                let p = 0, a = 0;
                snap.forEach(child => {
                    if(child.val().status === 'pending') p++;
                    else a++;
                });
                document.getElementById('pending_libs').innerText = p;
                document.getElementById('total_libs').innerText = a;
            });
        }

        function renderCharts(stats) {
            // ÙƒÙˆØ¯ Chart.js Ø§Ù„Ù…Ø±ÙƒØ² Ù…Ø¹ Ø£Ù„ÙˆØ§Ù† Ù…ØªÙ†Ø§Ø³Ù‚Ø©
            new Chart(document.getElementById('degreeChart'), {
                type: 'doughnut',
                data: { labels: Object.keys(stats.degree), datasets: [{ data: Object.values(stats.degree), backgroundColor: ['#1e40af', '#fbbf24'] }] },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 9 } } } } }
            });

            new Chart(document.getElementById('yearChart'), {
                type: 'bar',
                data: { labels: Object.keys(stats.years), datasets: [{ label: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', data: Object.values(stats.years), backgroundColor: '#10b981' }] },
                options: { maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
            });

            new Chart(document.getElementById('uniChart'), {
                type: 'pie',
                data: { labels: Object.keys(stats.unis).slice(0, 5), datasets: [{ data: Object.values(stats.unis).slice(0, 5), backgroundColor: ['#1e3a8a', '#334155', '#059669', '#d97706', '#7c3aed'] }] },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 8 } } } } }
            });
        }

        loadStats();
    </script>
</body>
</html>
