<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ© | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f8fafc; font-family: 'Segoe UI', Tahoma, sans-serif; height: 100vh; overflow: hidden; padding: 6px; display: flex; flex-direction: column; }
        
        /* Ù‡ÙŠØ¯Ø± Ù…Ø¶Ø§Ø¹Ù Ø§Ù„Ø­Ø¬Ù… */
        .portal-header-giant { background: white; padding: 25px 30px; border-radius: 15px; border-bottom: 6px solid #1e3a8a; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .portal-title { font-size: 32px; font-weight: 900; color: #1e3a8a; letter-spacing: -1px; }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…ØªØ¯Ø±Ø¬Ø© */
        .card-1 { background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border: 1px solid #bfdbfe; }
        .card-2 { background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 1px solid #bbf7d0; }
        .card-3 { background: linear-gradient(135deg, #fefce8 0%, #fef9c3 100%); border: 1px solid #fef08a; }

        .btn-panel { @apply flex flex-col items-center justify-center p-2 rounded-xl border border-slate-200 bg-white hover:bg-blue-50 hover:border-blue-300 transition-all active:scale-95 shadow-sm; }
        canvas { max-height: 140px !important; }
        
        /* Ø¬Ø¯ÙˆÙ„ Ù…ÙƒØ«Ù Ø¬Ø¯Ø§Ù‹ */
        .compact-table { font-size: 10px; width: 100%; border-collapse: collapse; }
        .compact-table th { background: #334155; color: white; padding: 4px; position: sticky; top: 0; }
        .compact-table td { border: 1px solid #e2e8f0; padding: 3px 6px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body>

    <div class="portal-header-giant">
        <div class="flex items-center gap-6">
            <div class="bg-blue-900 text-white p-3 rounded-2xl text-2xl">ğŸ›ï¸</div>
            <div>
                <h1 class="portal-title text-blue-900">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</h1>
                <p class="text-sm text-slate-500 font-bold italic">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯ - ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ</p>
            </div>
        </div>
        <div class="text-left font-mono text-sm font-bold text-slate-600 bg-slate-100 p-3 rounded-xl border">
            <div id="live-date"></div>
            <div id="live-time" class="text-blue-700"></div>
        </div>
    </div>

    <div class="grid grid-cols-6 gap-2 mb-3">
        <a href="index.html" class="btn-panel"><span class="text-xl">ğŸŒ</span> <span class="text-[10px] font-bold">Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</span></a>
        <a href="add_thesis.html" class="btn-panel"><span class="text-xl">âœï¸</span> <span class="text-[10px] font-bold">Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª</span></a>
        <a href="requests.html" class="btn-panel"><span class="text-xl">ğŸ“©</span> <span class="text-[10px] font-bold">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯Ø¯</span></a>
        <a href="libraries_mgt.html" class="btn-panel"><span class="text-xl">ğŸ“‘</span> <span class="text-[10px] font-bold">Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª</span></a>
        <button onclick="window.print()" class="btn-panel"><span class="text-xl">ğŸ“Š</span> <span class="text-[10px] font-bold">ØªÙ‚Ø§Ø±ÙŠØ± PDF</span></a>
        <button onclick="location.reload()" class="btn-panel"><span class="text-xl">ğŸ”„</span> <span class="text-[10px] font-bold">ØªØ­Ø¯ÙŠØ«</span></a>
    </div>

    <div class="grid grid-cols-4 gap-3 mb-3">
        <div class="card-1 p-3 rounded-xl text-center"><span class="text-[10px] font-bold text-blue-600">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø·Ø±ÙˆØ­Ø§Øª</span><b id="count_theses" class="text-2xl block text-slate-800">-</b></div>
        <div class="card-2 p-3 rounded-xl text-center"><span class="text-[10px] font-bold text-emerald-600">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª</span><b id="count_unis" class="text-2xl block text-slate-800">-</b></div>
        <div class="card-3 p-3 rounded-xl text-center"><span class="text-[10px] font-bold text-amber-600">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</span><b id="count_pending" class="text-2xl block text-slate-800">-</b></div>
        <div class="bg-white border p-3 rounded-xl text-center border-l-4 border-slate-800"><span class="text-[10px] font-bold text-slate-500">Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</span><b id="count_libs" class="text-2xl block text-slate-800">-</b></div>
    </div>

    <div class="grid grid-cols-3 gap-3 flex-grow overflow-hidden">
        <div class="bg-white p-2 rounded-xl shadow-sm border flex flex-col">
            <h3 class="text-[10px] font-bold mb-1 text-slate-500 underline">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</h3>
            <canvas id="chart1"></canvas>
        </div>
        <div class="bg-white p-2 rounded-xl shadow-sm border flex flex-col">
            <h3 class="text-[10px] font-bold mb-1 text-slate-500 underline">Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠ</h3>
            <canvas id="chart2"></canvas>
        </div>
        
        <div class="bg-white rounded-xl shadow-sm border flex flex-col overflow-hidden">
            <div class="bg-slate-50 p-2 flex justify-between items-center border-b">
                <h3 class="text-[10px] font-bold text-slate-700">Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h3>
                <a href="index.html" class="text-[9px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full hover:bg-blue-200">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
            </div>
            <div class="overflow-y-auto flex-grow">
                <table class="compact-table">
                    <thead>
                        <tr><th>Ø§Ù„Ø¨Ø§Ø­Ø«</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th></tr>
                    </thead>
                    <tbody id="miniTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function startClock() {
            const now = new Date();
            document.getElementById('live-date').innerText = now.toLocaleDateString('ar-LY', {weekday:'long', year:'numeric', month:'long', day:'numeric'});
            document.getElementById('live-time').innerText = now.toLocaleTimeString('ar-LY');
        }
        setInterval(startClock, 1000);

        function loadAll() {
            db.ref('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø±Ø³Ø§Ø¦Ù„').on('value', snap => {
                let data = [], stats = {deg:{}, years:{}, unis:{}};
                snap.forEach(c => {
                    let v = c.val();
                    data.push(v);
                    if(v.Ø§Ù„Ø¯Ø±Ø¬Ø©) stats.deg[v.Ø§Ù„Ø¯Ø±Ø¬Ø©] = (stats.deg[v.Ø§Ù„Ø¯Ø±Ø¬Ø©]||0)+1;
                    if(v.Ø§Ù„Ø³Ù†Ø©) stats.years[v.Ø§Ù„Ø³Ù†Ø©] = (stats.years[v.Ø§Ù„Ø³Ù†Ø©]||0)+1;
                    if(v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©) stats.unis[v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©] = (stats.unis[v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©]||0)+1;
                });
                document.getElementById('count_theses').innerText = data.length;
                document.getElementById('count_unis').innerText = Object.keys(stats.unis).length;
                
                // Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙƒØ«Ù (Ø¢Ø®Ø± 10)
                const tbody = document.getElementById('miniTableBody');
                tbody.innerHTML = data.reverse().slice(0, 10).map(d => `
                    <tr>
                        <td title="${d.Ø§Ù„Ø¨Ø§Ø­Ø«}">${d.Ø§Ù„Ø¨Ø§Ø­Ø« ? d.Ø§Ù„Ø¨Ø§Ø­Ø«.split(' ')[0] : '-'}</td>
                        <td class="text-right font-bold text-blue-900">${d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù†}</td>
                        <td>${d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©}</td>
                    </tr>`).join('');
                
                renderCharts(stats);
            });

            db.ref('libraries').on('value', snap => {
                let p=0, a=0;
                snap.forEach(c => { if(c.val().status === 'pending') p++; else a++; });
                document.getElementById('count_pending').innerText = p;
                document.getElementById('count_libs').innerText = a;
            });
        }

        function renderCharts(s) {
            new Chart(document.getElementById('chart1'), {
                type: 'doughnut',
                data: { labels: Object.keys(s.deg), datasets: [{ data: Object.values(s.deg), backgroundColor: ['#1e40af', '#f59e0b'] }] },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 8, font: { size: 8 } } } } }
            });
            new Chart(document.getElementById('chart2'), {
                type: 'line',
                data: { labels: Object.keys(s.years), datasets: [{ label: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', data: Object.values(s.years), borderColor: '#10b981', fill: true, backgroundColor: 'rgba(16, 185, 129, 0.1)' }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
            });
        }
        loadAll();
        startClock();
    </script>
</body>
</html>
