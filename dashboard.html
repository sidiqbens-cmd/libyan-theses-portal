<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุฅุญุตุงุฆูุงุช ุจูุงุจุฉ ุงูุฑุณุงุฆู ุงูุฌุงูุนูุฉ ุงูููุจูุฉ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; padding: 10px; }
        .grid-layout { display: grid; grid-template-columns: repeat(4, 1fr); grid-template-rows: auto 1fr 1fr; gap: 10px; height: 95vh; }
        .card { background: #1e293b; border-radius: 12px; padding: 15px; border: 1px solid #334155; }
        .stat-val { font-size: 2rem; font-weight: 900; color: #38bdf8; }
        .chart-container { position: relative; height: 100%; width: 100%; }
    </style>
</head>
<body>

    <div class="grid-layout">
        <div class="col-span-4 flex justify-between items-center bg-slate-800 p-4 rounded-xl">
            <h1 class="text-xl font-bold text-sky-400">๐ ููุญุฉ ุงูุฅุญุตุงุฆูุงุช ูุงูููู ุงูุฑููู</h1>
            <a href="admin.html" class="bg-sky-600 px-4 py-2 rounded-lg text-sm font-bold">โ ุงูุนูุฏุฉ ููุชุญูู</a>
        </div>

        <div class="card flex flex-col items-center">
            <span class="text-xs text-slate-400">ุฅุฌูุงูู ุงูุฃุจุญุงุซ</span>
            <div id="total_theses" class="stat-val">-</div>
        </div>
        <div class="card flex flex-col items-center">
            <span class="text-xs text-slate-400">ุงูุฌุงูุนุงุช ุงููุดุงุฑูุฉ</span>
            <div id="total_unis" class="stat-val">-</div>
        </div>
        <div class="card flex flex-col items-center">
            <span class="text-xs text-slate-400">ุงูููุชุจุงุช ุงููุนุชูุฏุฉ</span>
            <div id="total_libs" class="stat-val">-</div>
        </div>
        <div class="card flex flex-col items-center border-amber-500/50">
            <span class="text-xs text-slate-400">ุทูุจุงุช ููุฏ ุงููุฑุงุฌุนุฉ</span>
            <div id="pending_libs" class="stat-val text-amber-500">-</div>
        </div>

        <div class="card col-span-2">
            <h3 class="text-center text-sm mb-4">ุชูุฒูุน ุงูุฑุณุงุฆู ุญุณุจ ุงูุณููุงุช</h3>
            <div class="chart-container"><canvas id="yearChart"></canvas></div>
        </div>
        <div class="card col-span-2">
            <h3 class="text-center text-sm mb-4">ุฃูุซุฑ 5 ุฌุงูุนุงุช ูุณุงููุฉ</h3>
            <div class="chart-container"><canvas id="uniChart"></canvas></div>
        </div>
        <div class="card col-span-2">
            <h3 class="text-center text-sm mb-4">ุชุตููู ุงูุฏุฑุฌุงุช ุงูุนูููุฉ</h3>
            <div class="chart-container"><canvas id="degreeChart"></canvas></div>
        </div>
        <div class="card col-span-2 flex flex-col">
            <h3 class="text-center text-sm mb-2">ุขุฎุฑ ุงููุดุงุทุงุช</h3>
            <div id="recent_list" class="text-[10px] space-y-2 overflow-y-auto">
                </div>
        </div>
    </div>

    <script>
        // ุถุน ููุฏ Firebase Config ููุง (ููุณ ุงูููุฏ ุงูุฎุงุต ุจู)
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ููุทู ุฌูุจ ุงูุจูุงูุงุช ูุงูุฑุณูู (ููุณ ุงูููุทู ุงูุณุงุจู ูููู ููุง ูู ููู ูุธูู)
        db.ref('ุจูุงูุงุช_ุงูุฑุณุงุฆู').on('value', snap => {
            let stats = { degree: {}, years: {}, unis: {} };
            let recent = [];
            snap.forEach(child => {
                let d = child.val();
                if(d.ุงูุฏุฑุฌุฉ) stats.degree[d.ุงูุฏุฑุฌุฉ] = (stats.degree[d.ุงูุฏุฑุฌุฉ] || 0) + 1;
                if(d.ุงูุณูุฉ) stats.years[d.ุงูุณูุฉ] = (stats.years[d.ุงูุณูุฉ] || 0) + 1;
                if(d.ุงูุฌุงูุนุฉ) stats.unis[d.ุงูุฌุงูุนุฉ] = (stats.unis[d.ุงูุฌุงูุนุฉ] || 0) + 1;
                recent.push(d);
            });
            
            document.getElementById('total_theses').innerText = recent.length;
            document.getElementById('total_unis').innerText = Object.keys(stats.unis).length;
            
            renderDashboardCharts(stats);
            updateRecentList(recent.reverse().slice(0, 5));
        });

        // ุฏูุงู ุงูุฑุณู ูุงูุชุญุฏูุซ ุชุณุชูุฑ ููุง...
        function renderDashboardCharts(stats) {
            Chart.defaults.color = '#94a3b8';
            // ููุฏ Chart.js (ููุณ ุงูุฐู ุตูููุงู ุณุงุจูุงู)
            new Chart(document.getElementById('yearChart'), {
                type: 'line',
                data: {
                    labels: Object.keys(stats.years),
                    datasets: [{ label: 'ุงูููู ุงูุณููู', data: Object.values(stats.years), borderColor: '#38bdf8', tension: 0.4 }]
                },
                options: { maintainAspectRatio: false }
            });
            // ... ุจุงูู ุงูุฑุณูู
        }

        function updateRecentList(list) {
            document.getElementById('recent_list').innerHTML = list.map(item => 
                `<div class="bg-slate-700/50 p-2 rounded">ุชูุช ุฅุถุงูุฉ: <b>${item.ุงูุนููุงู}</b> ูู ูุจู <b>${item.ุงูุจุงุญุซ}</b></div>`
            ).join('');
        }
    </script>
</body>
</html>
