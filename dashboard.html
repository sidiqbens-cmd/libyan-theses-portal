<thead>
    <tr>
        <th>اسم المكتبة</th>
        <th>المدينة</th> <th>التبعية</th> <th>بيانات التواصل</th>
        <th>الموقع</th>
        <th>تاريخ الطلب</th>
        <th>الإجراء</th>
    </tr>
</thead>
<tbody id="tableBody"></tbody>

<script>
// دالة الاعتماد التي تقوم بنقل البيانات وحذفها من الانتظار
function approve(id, data) {
    if (confirm(`هل أنت متأكد من اعتماد مكتبة: ${data.libraryName || data.name}?`)) {
        // 1. نقل البيانات إلى مسار المكتبات المعتمدة
        db.ref('approved_libraries').child(id).set({
            ...data,
            approvalDate: new Date().toLocaleString('ar-LY'),
            status: 'approved'
        }).then(() => {
            // 2. حذف الطلب من قائمة الانتظار بعد نجاح النقل
            return db.ref('join_requests').child(id).remove();
        }).then(() => {
            alert("تم اعتماد المكتبة بنجاح ونقلها للدليل العام.");
        }).catch((error) => {
            console.error("خطأ في الاعتماد:", error);
            alert("حدث خطأ أثناء الاعتماد.");
        });
    }
}

// تحديث طريقة عرض الصفوف لربط الزر بالدالة
function renderRow(id, data) {
    const tbody = document.getElementById('tableBody');
    const row = `
        <tr class="hover:bg-blue-50">
            <td class="font-bold text-blue-900">${data.libraryName || data.name || '-'}</td>
            <td class="bg-yellow-50 font-bold">${data.city || data.college || '-'}</td>
            <td>${data.affiliation || data.university || '-'}</td>
            <td>${data.phone || '-'}</td>
            <td><a href="${data.location || data.mapUrl}" target="_blank" class="text-blue-600 underline">خرائط</a></td>
            <td class="text-gray-500">${data.requestDate || data.joinDate || '-'}</td>
            <td>
                <button onclick='approve("${id}", ${JSON.stringify(data)})' class="bg-green-700 text-white px-2 py-1 rounded text-[10px] hover:bg-black">
                    اعتماد ✅
                </button>
            </td>
        </tr>`;
    tbody.innerHTML += row;
}
</script>
