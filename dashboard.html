<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة التحكم | الفهرس الليبي</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="bg-gray-100 p-6">
    <div class="max-w-5xl mx-auto bg-white shadow-lg rounded-lg p-5">
        <h2 class="text-2xl font-bold text-blue-900 mb-6 border-b-2 border-blue-900 pb-2">طلبات الانضمام الواردة</h2>
        <table class="w-full text-sm text-center border-collapse">
            <thead>
                <tr class="bg-blue-900 text-white">
                    <th class="p-3">المكتبة</th>
                    <th class="p-3">التبعية (الجامعة)</th>
                    <th class="p-3">الهاتف</th>
                    <th class="p-3">الإجراء</th>
                </tr>
            </thead>
            <tbody id="requestsList">
                </tbody>
        </table>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            projectId: "libyan-theses-portal",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // القراءة من مجلد join_requests الموضح في لقطة شاشتك
        db.ref('join_requests').on('value', (snapshot) => {
            const list = document.getElementById('requestsList');
            list.innerHTML = '';
            
            snapshot.forEach((child) => {
                const data = child.val();
                const key = child.key;

                list.innerHTML += `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3 font-bold text-blue-800">${data.libraryName || 'بدون اسم'}</td>
                        <td class="p-3">${data.affiliation || '-'}</td>
                        <td class="p-3 font-mono">${data.phone || '-'}</td>
                        <td class="p-3">
                            <button onclick="approve('${key}')" class="bg-green-600 text-white px-4 py-1 rounded shadow hover:bg-green-700">اعتماد</button>
                        </td>
                    </tr>`;
            });
        });

        function approve(id) {
            db.ref('join_requests').on('value', (snapshot) => {
    const tbody = document.getElementById('requestsList');حسب المسمى عندك
    tbody.innerHTML = '';
    
    snapshot.forEach((child) => {
        const data = child.val();
        const key = child.key;

        // كود ذكي لاختيار المسمى المتاح (القديم أو الجديد)
        const name = data.libraryName || data.name || "غير مسمى";
        const aff = data.affiliation || data.university || data.uni || "-";
        const phone = data.phone || "-";

        tbody.innerHTML += `
            <tr class="border-b hover:bg-gray-50">
                <td class="p-3 font-bold text-blue-900">${name}</td>
                <td class="p-3">${aff}</td>
                <td class="p-3 font-mono text-green-700">${phone}</td>
                <td class="p-3">
                    <button onclick="approve('${key}')" class="bg-green-600 text-white px-4 py-1 rounded text-xs font-bold hover:bg-green-700 shadow-sm">اعتماد</button>
                    <button onclick="reject('${key}')" class="text-red-500 mr-2 text-xs">حذف</button>
                </td>
            </tr>
        `;
    });
});
        }
    </script>
</body>
</html>
