<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ© | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #fdfdfd; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; padding: 12px; }
        
        /* Ù‡ÙŠØ¯Ø± ÙØ®Ù… ÙˆØ¹Ø±ÙŠØ¶ */
        .giant-header { padding: 30px; border-bottom: 8px solid #1e3a8a; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        /* Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ */
        .nav-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        .nav-btn { @apply flex-1 py-2.5 rounded-xl border border-slate-200 bg-white text-[11px] font-black text-slate-600 hover:bg-slate-50 transition-all flex items-center justify-center gap-2 shadow-sm; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³ÙˆÙ… - ÙƒØ¨ÙŠØ±Ø© ÙˆØ¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ§Øª */
        .charts-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; flex: 2; align-items: center; margin-bottom: 20px; }
        .chart-wrap { position: relative; height: 100%; width: 100%; display: flex; flex-direction: column; align-items: center; }
        .chart-label { font-size: 11px; font-weight: 900; color: #64748b; margin-top: 10px; border-top: 1px solid #e2e8f0; width: 100%; text-align: center; padding-top: 5px; }

        /* Ø§Ù„Ø£Ø³ÙÙ„: Ø¨Ø·Ø§Ù‚Ø§Øª Ø±Ø´ÙŠÙ‚Ø© ÙˆØ¬Ø¯ÙˆÙ„ */
        .bottom-section { display: grid; grid-template-columns: 1.2fr 2fr; gap: 15px; flex: 1.2; min-height: 0; }
        .lean-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .stat-strip { @apply bg-white border border-slate-100 rounded-lg flex flex-col items-center justify-center p-2 shadow-sm; }
        .stat-strip b { @apply text-2xl text-blue-900 leading-none; }
        .stat-strip span { @apply text-[9px] font-bold text-slate-400 mt-1; }

        .table-wrap { background: white; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; display: flex; flex-direction: column; }
        table { width: 100%; font-size: 10px; }
        th { @apply bg-slate-800 text-white p-2 text-center; }
        td { @apply p-2 border-b text-center truncate; }
        
        canvas { max-height: 200px !important; }
    </style>
</head>
<body>

    <div class="giant-header bg-white rounded-2xl shadow-sm">
        <div class="flex items-center gap-8">
            <div class="text-5xl bg-blue-900 text-white p-5 rounded-3xl shadow-lg">ğŸ›ï¸</div>
            <div>
                <h1 class="text-4xl font-black text-blue-900 tracking-tighter">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ© Ø§Ù„Ù„ÙŠØ¨ÙŠØ©</h1>
                <div class="flex items-center gap-3 mt-2">
                    <span class="h-1 w-20 bg-blue-600 rounded"></span>
                    <p class="text-sm font-bold text-slate-400">Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ÙˆØ§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠ</p>
                </div>
            </div>
        </div>
        <div id="clock" class="text-lg font-mono font-bold text-blue-700 bg-blue-50 px-6 py-3 rounded-2xl border-2 border-blue-100 shadow-inner"></div>
    </div>

    <div class="nav-bar">
        <a href="index.html" class="nav-btn border-b-4 border-b-blue-500">ğŸŒ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±</a>
        <a href="upload.html" class="nav-btn border-b-4 border-b-emerald-500">ğŸ“¤ Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Excel)</a>
        <a href="requests.html" class="nav-btn border-b-4 border-b-amber-500">ğŸ“© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…</a>
        <a href="approved_libraries.html" class="nav-btn border-b-4 border-b-indigo-500">ğŸ›ï¸ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</a>
        <button onclick="window.print()" class="nav-btn border-b-4 border-b-rose-500">ğŸ–¨ï¸ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</button>
    </div>

    <div class="charts-container">
        <div class="chart-wrap">
            <canvas id="degChart"></canvas>
            <span class="chart-label">ØªØµÙ†ÙŠÙ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</span>
        </div>
        <div class="chart-wrap">
            <canvas id="yearChart"></canvas>
            <span class="chart-label">Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„Ù†Ù…Ùˆ</span>
        </div>
        <div class="chart-wrap">
            <canvas id="uniChart"></canvas>
            <span class="chart-label">ØªÙˆØ²Ø¹ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ø¨Ø­Ø«ÙŠØ© (Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª)</span>
        </div>
    </div>

    <div class="bottom-section">
        <div class="lean-stats">
            <div class="stat-strip"><b>-</b><span id="t_theses">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span></div>
            <div class="stat-strip"><b>-</b><span id="t_unis">Ø¬Ø§Ù…Ø¹Ø© Ù…Ø´Ø§Ø±ÙƒØ©</span></div>
            <div class="stat-strip"><b>-</b><span id="t_pending" class="text-amber-600">Ø·Ù„Ø¨Ø§Øª Ø§Ù†ØªØ¸Ø§Ø±</span></div>
            <div class="stat-strip"><b>-</b><span id="t_libs">Ù…ÙƒØªØ¨Ø© Ù…Ø¹ØªÙ…Ø¯Ø©</span></div>
        </div>

        <div class="table-wrap">
            <div class="bg-slate-50 p-2 text-[10px] font-black border-b flex justify-between">
                <span>Ø¢Ø®Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ ØªÙ… ØªØ¯Ù‚ÙŠÙ‚Ù‡Ø§ ÙˆØ§Ø¹ØªÙ…Ø§Ø¯Ù‡Ø§</span>
                <span class="text-blue-600">Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ§Ù…Ù„Ø© â†</span>
            </div>
            <div class="overflow-y-auto flex-grow">
                <table id="dashTable">
                    <thead><tr><th width="20%">Ø§Ù„Ø¨Ø§Ø­Ø«</th><th>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th><th width="25%">Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function load() {
            db.ref('Ø¨ÙŠØ§Ù†Ø§Øª_Ø§Ù„Ø±Ø³Ø§Ø¦Ù„').on('value', snap => {
                let data = [], s = {d:{}, y:{}, u:{}};
                snap.forEach(c => {
                    let v = c.val(); data.push(v);
                    if(v.Ø§Ù„Ø¯Ø±Ø¬Ø©) s.d[v.Ø§Ù„Ø¯Ø±Ø¬Ø©] = (s.d[v.Ø§Ù„Ø¯Ø±Ø¬Ø©]||0)+1;
                    if(v.Ø§Ù„Ø³Ù†Ø©) s.y[v.Ø§Ù„Ø³Ù†Ø©] = (s.y[v.Ø§Ù„Ø³Ù†Ø©]||0)+1;
                    if(v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©) s.u[v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©] = (s.u[v.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©]||0)+1;
                });
                document.querySelector('#t_theses').previousElementSibling.innerText = data.length;
                document.querySelector('#t_unis').previousElementSibling.innerText = Object.keys(s.u).length;
                
                render(s);
                document.querySelector('#dashTable tbody').innerHTML = data.reverse().slice(0, 8).map(d => `
                    <tr><td>${d.Ø§Ù„Ø¨Ø§Ø­Ø« || '-'}</td><td class="text-right font-bold text-blue-900">${d.Ø§Ù„Ø¹Ù†ÙˆØ§Ù†}</td><td>${d.Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©}</td></tr>
                `).join('');
            });

            db.ref('libraries').on('value', snap => {
                let p=0, a=0;
                snap.forEach(c => { if(c.val().status === 'pending') p++; else a++; });
                document.querySelector('#t_pending').previousElementSibling.innerText = p;
                document.querySelector('#t_libs').previousElementSibling.innerText = a;
            });
        }

        function render(s) {
            Chart.defaults.color = '#94a3b8';
            const opt = { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { boxWidth: 10, font: { size: 9, weight: 'bold' } } } } };
            
            // Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø®Ù„ÙÙŠØ§Øª (ÙÙ‚Ø· Ø§Ù„Ù…Ø­ØªÙˆÙ‰)
            new Chart(document.getElementById('degChart'), { type: 'doughnut', data: { labels: Object.keys(s.d), datasets: [{ data: Object.values(s.d), backgroundColor: ['#1e40af', '#fbbf24'], borderWidth: 0 }] }, options: opt });
            new Chart(document.getElementById('yearChart'), { type: 'line', data: { labels: Object.keys(s.y), datasets: [{ label: 'Ø§Ù„Ø±Ø³Ø§Ø¦Ù„', data: Object.values(s.y), borderColor: '#10b981', tension: 0.4, fill: true, backgroundColor: 'rgba(16, 185, 129, 0.05)' }] }, options: { ...opt, scales: { y: { display: false }, x: { grid: { display: false } } } } });
            new Chart(document.getElementById('uniChart'), { type: 'pie', data: { labels: Object.keys(s.u).slice(0, 5), datasets: [{ data: Object.values(s.u).slice(0, 5), backgroundColor: ['#1e3a8a', '#334155', '#059669', '#d97706', '#7c3aed'], borderWidth: 0 }] }, options: opt });
        }

        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleString('ar-LY'); }, 1000);
        load();
    </script>
</body>
</html>
