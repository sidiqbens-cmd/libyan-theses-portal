<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุฑูุน ุงูุฑุณุงุฆู | ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .dense-input { padding: 4px 8px; font-size: 13px; border: 1px solid #ddd; border-radius: 4px; width: 100%; }
        label { font-size: 11px; font-weight: bold; color: #555; display: block; margin-bottom: 2px; }
    </style>
</head>
<body class="bg-gray-100 p-2">

    <div class="max-w-5xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
        <div class="bg-blue-800 text-white p-3 flex justify-between items-center">
            <h1 class="text-lg font-bold">ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ - ููุญุฉ ุงูููุฏูุจ</h1>
            <div class="flex gap-2">
                <button onclick="downloadExcelTemplate()" class="bg-green-600 hover:bg-green-700 text-xs py-1 px-3 rounded">๐ฅ ุชุญููู ูุงูุจ ุงูุฅูุณู</button>
                <input type="file" id="excelFile" class="hidden" accept=".xlsx, .xls" onchange="handleExcel(event)">
                <button onclick="document.getElementById('excelFile').click()" class="bg-yellow-500 hover:bg-yellow-600 text-xs py-1 px-3 text-blue-900 font-bold rounded">๐ค ุฑูุน ุฅูุณู ุฌูุงุนู</button>
            </div>
        </div>

        <div class="p-4 border-b">
            <h2 class="text-sm font-bold mb-3 border-r-4 border-blue-600 pr-2">ุฅุถุงูุฉ ุฑุณุงูุฉ ุฌุฏูุฏุฉ</h2>
            <form id="singleUploadForm" class="grid grid-cols-4 gap-3">
                <div>
                    <label>ุฑูู ุงูุฑุณุงูุฉ</label>
                    <input type="text" id="thesisID" class="dense-input" required>
                </div>
                <div class="col-span-2">
                    <label>ุนููุงู ุงูุฑุณุงูุฉ</label>
                    <input type="text" id="title" class="dense-input" required>
                </div>
                <div>
                    <label>ุงุณู ุงูุจุงุญุซ</label>
                    <input type="text" id="author" class="dense-input" required>
                </div>
                <div>
                    <label>ุงูุฌุงูุนุฉ / ุงููููุฉ</label>
                    <input type="text" id="university" class="dense-input" required>
                </div>
                <div>
                    <label>ุงุณู ุงููุดุฑู</label>
                    <input type="text" id="supervisor" class="dense-input">
                </div>
                <div>
                    <label>ุงูุณูุฉ</label>
                    <input type="number" id="year" class="dense-input" required>
                </div>
                <div>
                    <label>ุงูุญุงูุฉ</label>
                    <select id="status" class="dense-input">
                        <option value="ูุชููุฑุฉ">โ ูุชููุฑุฉ</option>
                        <option value="ุบูุฑ ูุชููุฑุฉ">โ ุบูุฑ ูุชููุฑุฉ</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label>ุฑุงุจุท ุงูุฑุณุงูุฉ (ุฅู ูุฌุฏ)</label>
                    <input type="url" id="link" class="dense-input" placeholder="http://...">
                </div>
                <div class="col-span-2">
                    <label>ููุงุญุธุงุช ุฅุถุงููุฉ</label>
                    <input type="text" id="notes" class="dense-input">
                </div>
                <div class="col-span-4 flex justify-end">
                    <button type="submit" class="bg-blue-600 text-white px-6 py-1 rounded text-sm hover:bg-blue-700">ุญูุธ ุงูุฑุณุงูุฉ</button>
                </div>
            </form>
        </div>

        <div class="p-2 bg-gray-50 max-h-[300px] overflow-y-auto">
            <table class="w-full text-[12px] text-right border-collapse">
                <thead class="bg-gray-200 sticky top-0">
                    <tr>
                        <th class="p-1 border">ุงูุฑูู</th>
                        <th class="p-1 border">ุงูุนููุงู</th>
                        <th class="p-1 border">ุงูุจุงุญุซ</th>
                        <th class="p-1 border">ุงูุญุงูุฉ</th>
                        <th class="p-1 border">ุงูููุงุญุธุงุช</th>
                    </tr>
                </thead>
                <tbody id="previewTable">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // ุฅุนุฏุงุฏุงุช Firebase
        const firebaseConfig = { /*const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            projectId: "libyan-theses-portal",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ุญูุธ ุฑุณุงูุฉ ูุงุญุฏุฉ
        document.getElementById('singleUploadForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const data = {
                id: document.getElementById('thesisID').value,
                title: document.getElementById('title').value,
                author: document.getElementById('author').value,
                uni: document.getElementById('university').value,
                sup: document.getElementById('supervisor').value,
                year: document.getElementById('year').value,
                status: document.getElementById('status').value,
                link: document.getElementById('link').value,
                notes: document.getElementById('notes').value,
                timestamp: Date.now()
            };
            
            db.ref('theses/').push(data).then(() => {
                alert("ุชู ุงูุญูุธ ุจูุฌุงุญ");
                addToTable(data);
                this.reset();
            });
        });

        // ูุธููุฉ ุงูุฅูุณู (ุชุญููู ุงููุงูุจ)
        function downloadExcelTemplate() {
            const data = [["ุฑูู ุงูุฑุณุงูุฉ", "ุงูุนููุงู", "ุงูุจุงุญุซ", "ุงูุฌุงูุนุฉ", "ุงููุดุฑู", "ุงูุณูุฉ", "ุงูุญุงูุฉ", "ุงูุฑุงุจุท", "ุงูููุงุญุธุงุช"]];
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Template");
            XLSX.writeFile(wb, "Libyan_Theses_Template.xlsx");
        }

        // ูุนุงูุฌุฉ ููู ุงูุฅูุณู ุงููุฑููุน
        function handleExcel(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                
                // ุฑูุน ูู ุณุทุฑ ุฅูู Firebase
                jsonData.forEach(row => {
                    db.ref('theses/').push(row);
                    addToTable(row);
                });
                alert("ุชู ุฑูุน " + jsonData.length + " ุฑุณุงูุฉ ุจูุฌุงุญ!");
            };
            reader.readAsArrayBuffer(file);
        }

        function addToTable(data) {
            const row = `<tr>
                <td class="p-1 border">${data.id || data["ุฑูู ุงูุฑุณุงูุฉ"]}</td>
                <td class="p-1 border">${data.title || data["ุงูุนููุงู"]}</td>
                <td class="p-1 border">${data.author || data["ุงูุจุงุญุซ"]}</td>
                <td class="p-1 border">${data.status || data["ุงูุญุงูุฉ"]}</td>
                <td class="p-1 border text-gray-500">${data.notes || data["ุงูููุงุญุธุงุช"] || '-'}</td>
            </tr>`;
            document.getElementById('previewTable').innerHTML += row;
        }
    </script>
</body>
</html>
