<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ | Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-size: 11px; background-color: #f1f5f9; padding: 5px; }
        .login-overlay { position: fixed; inset: 0; background: #1e3a8a; display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .main-card { background: white; border-radius: 4px; border-top: 4px solid #1e3a8a; margin-bottom: 5px; border: 1px solid #ddd; }
        input, select { width: 100%; padding: 4px; border: 1px solid #cbd5e1; border-radius: 3px; font-size: 11px; outline: none; }
        th { background: #1e3a8a; color: white; padding: 4px; border: 1px solid #cbd5e1; }
        td { padding: 3px; border: 1px solid #e2e8f0; text-align: center; background: white; }
        .edit-mode { background: #fffde7 !important; border: 1px solid #fbc02d !important; font-weight: bold; }
        .badge-green { background: #dcfce7; color: #166534; padding: 2px 5px; border-radius: 4px; }
        .badge-red { background: #fee2e2; color: #991b1b; padding: 2px 5px; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="loginScreen" class="login-overlay">
        <div class="bg-white p-6 rounded shadow-xl text-center w-80">
            <h2 class="font-bold mb-4 text-blue-900">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©</h2>
            <input type="password" id="passCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨Ø©" class="mb-4 text-center p-2 border-2 border-blue-900 text-lg">
            <button onclick="checkLogin()" class="bg-blue-900 text-white w-full py-2 rounded font-bold">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†Ø¸ÙˆÙ…Ø©</button>
            <p id="loginError" class="text-red-600 mt-2 hidden">Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­!</p>
        </div>
    </div>

    <div id="adminContent" class="hidden">
        <div class="flex justify-between items-center mb-2 px-2">
            <div class="text-blue-900 font-bold">Ø¬Ù‡Ø© Ø§Ù„Ø±ÙØ¹: <span id="libraryNameDisplay" class="text-orange-600"></span></div>
            <h1 class="text-blue-900 font-bold text-xs italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
        </div>

        <div class="main-card p-3">
            <form id="thesisForm">
                <div class="grid grid-cols-4 gap-2 mb-2">
                    <input type="text" id="author" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«" required>
                    <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©" required>
                    <input type="text" id="supervisor" placeholder="Ø§Ù„Ù…Ø´Ø±Ù">
                    <input type="text" id="serialNum" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                </div>
                <div class="grid grid-cols-3 gap-2 mb-2">
                    <input type="text" id="university" placeholder="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" required>
                    <input type="text" id="college" placeholder="Ø§Ù„ÙƒÙ„ÙŠØ©" required>
                    <input type="text" id="department" placeholder="Ø§Ù„Ù‚Ø³Ù…" required>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-2">
                    <select id="degree"><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option></select>
                    <select id="status"><option value="Ù…ØªÙˆÙØ±Ø©">Ù…ØªÙˆÙØ±Ø©</option><option value="ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©">ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</option></select>
                    <input type="number" id="year" placeholder="Ø§Ù„Ø³Ù†Ø©">
                    <input type="url" id="link" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
                <div class="flex gap-2">
                    <input type="text" id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                    <button type="submit" class="bg-blue-900 text-white font-bold px-6 py-1 rounded">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ âœ…</button>
                </div>
            </form>
        </div>

        <div class="main-card p-2 bg-blue-50 grid grid-cols-6 gap-2 border-blue-200 border">
            <input type="text" id="gSearch" placeholder="ğŸ” Ø¨Ø­Ø« Ø´Ø§Ù…Ù„..." onkeyup="applyFilters()">
            <input type="text" id="fUni" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" onkeyup="applyFilters()">
            <input type="text" id="fColl" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„ÙƒÙ„ÙŠØ©" onkeyup="applyFilters()">
            <input type="text" id="fDept" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù‚Ø³Ù…" onkeyup="applyFilters()">
            <input type="text" id="fYear" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø³Ù†Ø©" onkeyup="applyFilters()">
            <select id="fDeg" onchange="applyFilters()"><option value="">ÙƒÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</option><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option></select>
        </div>

        <div class="main-card overflow-hidden">
            <table class="w-full border-collapse">
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø¨Ø§Ø­Ø«</th><th class="w-1/4">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th><th>Ø§Ù„Ø³Ù†Ø©</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="thesesTableBody"></tbody>
            </table>
        </div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc", authDomain: "libyan-theses-portal.firebaseapp.com", projectId: "libyan-theses-portal", databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app", appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙƒØ§ØªØ¨ (Ø§Ù„Ø£ÙƒÙˆØ§Ø¯)
    const libraries = {
        "101": "Ø¬Ø§Ù…Ø¹Ø© Ø·Ø±Ø§Ø¨Ù„Ø³ - Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø¢Ø¯Ø§Ø¨",
        "102": "Ø¬Ø§Ù…Ø¹Ø© Ø¨Ù†ØºØ§Ø²ÙŠ - Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©",
        "103": "Ø¬Ø§Ù…Ø¹Ø© Ø³Ø¨Ù‡Ø§ - Ù…ÙƒØªØ¨Ø© ÙƒÙ„ÙŠØ© Ø§Ù„Ø¹Ù„ÙˆÙ…"
    };

    let currentLibrary = "";

    function checkLogin() {
        const code = document.getElementById('passCode').value;
        if (libraries[code]) {
            currentLibrary = libraries[code];
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminContent').classList.remove('hidden');
            document.getElementById('libraryNameDisplay').innerText = currentLibrary;
            loadData();
        } else {
            document.getElementById('loginError').classList.remove('hidden');
        }
    }

    function loadData() {
        db.ref('theses_data').on('value', snap => {
            const tbody = document.getElementById('thesesTableBody');
            tbody.innerHTML = '';
            snap.forEach(child => {
                const v = child.val(); const id = child.key;
                const statusClass = v.status === "Ù…ØªÙˆÙØ±Ø©" ? "badge-green" : "badge-red";
                tbody.innerHTML += `<tr id="row-${id}">
                    <td>${v.author}</td><td class="text-right">${v.title}</td><td>${v.university}</td><td>${v.year}</td>
                    <td><span class="${statusClass}">${v.status}</span></td><td>${v.location || '-'}</td>
                    <td><button onclick="enableEdit('${id}')" class="bg-yellow-600 text-white px-1 rounded">ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="deleteRec('${id}')" class="bg-red-600 text-white px-1 rounded">X</button></td>
                </tr>`;
            });
        });
    }

    document.getElementById('thesisForm').onsubmit = (e) => {
        e.preventDefault();
        const data = {
            author: document.getElementById('author').value,
            title: document.getElementById('title').value,
            university: document.getElementById('university').value,
            college: document.getElementById('college').value,
            department: document.getElementById('department').value,
            degree: document.getElementById('degree').value,
            status: document.getElementById('status').value,
            year: document.getElementById('year').value,
            link: document.getElementById('link').value || "",
            location: currentLibrary, // Ø§Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯
            timestamp: new Date().toISOString()
        };
        db.ref('theses_data').push(data).then(() => {
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            document.getElementById('thesisForm').reset();
        });
    };

    // (Ø¨Ù‚ÙŠØ© Ø§Ù„Ø¯ÙˆØ§Ù„: Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ØŒ Ø§Ù„Ø­Ø°ÙØŒ Ø§Ù„ÙÙ„ØªØ±Ø© ØªØ¸Ù„ ÙƒÙ…Ø§ Ù‡ÙŠ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©)
    function deleteRec(id) { if(confirm("Ø­Ø°ÙØŸ")) db.ref('theses_data').child(id).remove(); }
</script>
</body>
</html>
