<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        body { background: #f1f5f9; font-family: 'Segoe UI', sans-serif; font-size: 10px; margin: 0; padding: 5px; overflow: hidden; }
        .dense-input { border: 1px solid #cbd5e1; padding: 2px 4px; border-radius: 2px; width: 100%; outline: none; height: 22px; }
        .label-dense { display: inline-block; width: 80px; text-align: left; padding-right: 5px; color: #475569; }
        table { width: 100%; border-collapse: collapse; background: white; table-layout: fixed; }
        th { background: #1e3a8a; color: white; padding: 4px; font-weight: bold; border: 1px solid #334155; position: sticky; top: 0; }
        td { border: 1px solid #e2e8f0; padding: 2px; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .btn-excel { font-size: 9px; padding: 2px 6px; border-radius: 2px; margin-left: 5px; color: white; font-weight: bold; }
        .filter-select { width: 100%; height: 20px; font-size: 9px; border: 1px solid #cbd5e1; outline: none; }
    </style>
</head>
<body>

    <div class="flex justify-between items-center mb-1 border-b pb-1">
        <div class="flex items-center">
            <button class="btn-excel bg-green-700">Ø±ÙØ¹ Ù…Ù„Ù Excel</button>
            <button class="btn-excel bg-green-600">ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Excel</button>
        </div>
        <div class="text-blue-900 font-bold text-xs italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    </div>

    <div class="bg-white border p-2 mb-1 shadow-sm">
        <form id="uploadForm">
            <div class="grid grid-cols-4 gap-x-4 gap-y-1">
                <div class="flex items-center"><span class="label-dense">Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«</span><input type="text" id="author" class="dense-input"></div>
                <div class="flex items-center"><span class="label-dense">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</span><input type="text" id="title" class="dense-input"></div>
                <div class="flex items-center"><span class="label-dense">Ø§Ù„Ù…Ø´Ø±Ù</span><input type="text" id="supervisor" class="dense-input"></div>
                <div class="flex items-center"><span class="label-dense">Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</span><input type="text" id="id_num" class="dense-input"></div>
                
                <div class="flex items-center"><span class="label-dense">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</span><input type="text" id="university" class="dense-input"></div>
                <div class="flex items-center"><span class="label-dense">Ø§Ù„ÙƒÙ„ÙŠØ©</span><input type="text" id="college" class="dense-input"></div>
                <div class="flex items-center"><span class="label-dense">Ø§Ù„Ù‚Ø³Ù…</span><input type="text" id="dept" class="dense-input"></div>
                <div class="flex items-center"><span class="label-dense">Ù…ÙƒØ§Ù† Ø§Ù„ØªÙˆØ§Ø¬Ø¯</span><input type="text" id="location" class="dense-input"></div>

                <div class="flex items-center">
                    <span class="label-dense">Ù…Ø§Ø¬Ø³ØªÙŠØ±</span>
                    <select id="degree" class="dense-input">
                        <option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                        <option>Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
                    </select>
                </div>
                <div class="flex items-center">
                    <span class="label-dense">Ù…ØªÙˆÙØ±Ø©</span>
                    <select id="status" class="dense-input">
                        <option>Ù…ØªÙˆÙØ±Ø©</option>
                        <option>ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</option>
                    </select>
                </div>
                <div class="flex items-center">
                    <span class="label-dense">Ø§Ù„Ø³Ù†Ø©</span>
                    <select id="year" class="dense-input"></select>
                </div>
                <div class="flex items-center"><span class="label-dense">Ø§Ù„Ø±Ø§Ø¨Ø·</span><input type="url" id="link" class="dense-input"></div>
            </div>
            
            <div class="grid grid-cols-4 gap-4 mt-2">
                <div class="col-span-1">
                    <button type="submit" id="saveBtn" class="bg-blue-900 text-white w-full py-1 rounded font-bold hover:bg-black flex items-center justify-center gap-2">
                        Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª <span id="checkIcon">âœ…</span>
                    </button>
                </div>
                <div class="col-span-3"><input type="text" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª" id="notes" class="dense-input"></div>
            </div>
        </form>
    </div>

    <div class="bg-slate-100 border-x border-t grid grid-cols-8 gap-0 text-center items-center">
        <div class="border-l p-1"><input type="text" placeholder="Ø¨Ø­Ø« Ø´Ø§Ù…Ù„..." class="filter-select text-center"></div>
        <div class="border-l p-1"><input type="text" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" class="filter-select text-center"></div>
        <div class="border-l p-1"><input type="text" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„ÙƒÙ„ÙŠØ©" class="filter-select text-center"></div>
        <div class="border-l p-1"><input type="text" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù‚Ø³Ù…" class="filter-select text-center"></div>
        <div class="border-l p-1"><input type="text" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø³Ù†Ø©" class="filter-select text-center"></div>
        <div class="border-l p-1"><input type="text" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù…ÙƒØ§Ù†" class="filter-select text-center"></div>
        <div class="border-l p-1"><input type="text" placeholder="ÙƒÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª" class="filter-select text-center"></div>
        <div class="p-1 font-bold text-blue-800">Ø§Ù„ÙÙ„Ø§ØªØ±</div>
    </div>

    <div class="bg-white border shadow-sm overflow-hidden" style="height: calc(100vh - 165px);">
        <div class="overflow-y-auto h-full">
            <table>
                <thead>
                    <tr>
                        <th width="80px">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th><th width="40px">Ø§Ù„Ø±Ø§Ø¨Ø·</th><th width="80px">Ø§Ù„Ù…ÙƒØ§Ù†</th><th width="60px">Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th>
                        <th width="60px">Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th width="40px">Ø§Ù„Ø³Ù†Ø©</th><th width="60px">Ø§Ù„Ù‚Ø³Ù…</th><th width="80px">Ø§Ù„ÙƒÙ„ÙŠØ©</th>
                        <th width="80px">Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th><th width="80px">Ø§Ù„Ù…Ø´Ø±Ù</th><th width="150px">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th width="100px">Ø§Ù„Ø¨Ø§Ø­Ø«</th>
                    </tr>
                </thead>
                <tbody id="thesesTable"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ù†ÙˆØ§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        const yearSelect = document.getElementById('year');
        for(let i=2026; i>=1970; i--) { let opt = document.createElement('option'); opt.value=i; opt.innerHTML=i; yearSelect.appendChild(opt); }

        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNITo9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "libyan-theses-portal",
            storageBucket: "libyan-theses-portal.appspot.com",
            messagingSenderId: "782635467382",
            appId: "1:782635467382:web:48a60589a194519f964082"
        };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        function loadTheses() {
            db.ref('theses').on('value', snap => {
                const tbody = document.getElementById('thesesTable');
                tbody.innerHTML = "";
                snap.forEach(child => {
                    const d = child.val();
                    tbody.innerHTML += `
                        <tr class="hover:bg-blue-50">
                            <td>
                                <button onclick="deleteItem('${child.key}')" class="bg-red-600 text-white px-1 rounded text-[9px]">X</button>
                                <button class="bg-blue-600 text-white px-1 rounded text-[9px]">ØªØ¹Ø¯ÙŠÙ„</button>
                            </td>
                            <td><a href="${d.link}" target="_blank">ğŸ”—</a></td>
                            <td>${d.location || '-'}</td>
                            <td>${d.id_num || '-'}</td>
                            <td>${d.degree}</td>
                            <td>${d.year}</td>
                            <td>${d.dept}</td>
                            <td>${d.college}</td>
                            <td>${d.university}</td>
                            <td>${d.supervisor}</td>
                            <td class="text-right px-1 font-bold text-blue-900">${d.title}</td>
                            <td>${d.author}</td>
                        </tr>`;
                });
            });
        }

        document.getElementById('uploadForm').onsubmit = function(e) {
            e.preventDefault();
            const data = {
                author: document.getElementById('author').value,
                title: document.getElementById('title').value,
                supervisor: document.getElementById('supervisor').value,
                id_num: document.getElementById('id_num').value,
                university: document.getElementById('university').value,
                college: document.getElementById('college').value,
                dept: document.getElementById('dept').value,
                location: document.getElementById('location').value,
                degree: document.getElementById('degree').value,
                status: document.getElementById('status').value,
                year: document.getElementById('year').value,
                link: document.getElementById('link').value,
                notes: document.getElementById('notes').value
            };
            db.ref('theses').push(data).then(() => { document.getElementById('uploadForm').reset(); });
        };

        function deleteItem(id) { if(confirm("Ø­Ø°ÙØŸ")) db.ref('theses').child(id).remove(); }
        loadTheses();
    </script>
</body>
</html>
