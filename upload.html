<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ุฑูุน ุงูุจูุงูุงุช | ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #f1f5f9; font-size: 12px; }
        .input-dense { padding: 4px 8px; border: 1px solid #cbd5e1; border-radius: 4px; width: 100%; outline: none; }
        .input-dense:focus { border-color: #1e40af; ring: 1px #1e40af; }
        label { display: block; margin-bottom: 2px; font-weight: bold; color: #334155; font-size: 11px; }
        th { background: #1e40af; color: white; padding: 6px; border: 1px solid #1e3a8a; }
        td { padding: 4px; border: 1px solid #e2e8f0; background: white; }
    </style>
</head>
<body class="p-2">

    <div class="max-w-[1400px] mx-auto bg-white shadow-xl rounded-lg overflow-hidden">
        <div class="bg-blue-900 text-white p-3 flex justify-between items-center">
            <h1 class="text-sm font-bold">ุฅุถุงูุฉ ุจูุงูุงุช ุงูุฑุณุงุฆู - ุงูููุฑุณ ุงูููุจู ุงูููุญุฏ</h1>
            <div class="flex gap-2">
                <button onclick="downloadTemplate()" class="bg-green-600 px-3 py-1 rounded text-[11px] hover:bg-green-700">๐ฅ ูุงูุจ ุงูุฅูุณู</button>
                <input type="file" id="excelFile" class="hidden" accept=".xlsx, .xls" onchange="handleExcel(event)">
                <button onclick="document.getElementById('excelFile').click()" class="bg-yellow-500 text-blue-900 px-3 py-1 rounded text-[11px] font-bold">๐ค ุฑูุน ุฅูุณู ุฌูุงุนู</button>
            </div>
        </div>

        <div class="p-3 border-b bg-blue-50">
            <form id="uploadForm" class="grid grid-cols-6 gap-2">
                <div><label>ุงุณู ุงูุจุงุญุซ</label><input type="text" id="author" class="input-dense" required></div>
                <div class="col-span-2"><label>ุนููุงู ุงูุฑุณุงูุฉ</label><input type="text" id="title" class="input-dense" required></div>
                <div><label>ุงุณู ุงููุดุฑู</label><input type="text" id="sup" class="input-dense"></div>
                <div><label>ุงูุฌุงูุนุฉ</label><input type="text" id="uni" class="input-dense" required></div>
                <div><label>ุงููููุฉ</label><input type="text" id="college" class="input-dense"></div>
                <div><label>ุงููุณู</label><input type="text" id="dept" class="input-dense"></div>
                <div><label>ุงูุณูุฉ</label><input type="number" id="year" class="input-dense"></div>
                <div><label>ุฑูู ุงูุฑุณุงูุฉ</label><input type="text" id="id" class="input-dense"></div>
                <div>
                    <label>ุงูุญุงูุฉ</label>
                    <select id="status" class="input-dense">
                        <option value="ูุชููุฑุฉ">โ ูุชููุฑุฉ</option>
                        <option value="ุบูุฑ ูุชููุฑุฉ">โ ุบูุฑ ูุชููุฑุฉ</option>
                    </select>
                </div>
                <div><label>ุฑุงุจุท ุงูุฑุณุงูุฉ</label><input type="url" id="link" class="input-dense"></div>
                <div><label>ููุงุญุธุงุช</label><input type="text" id="notes" class="input-dense"></div>
                <div class="flex items-end"><button type="submit" class="bg-blue-800 text-white w-full py-1 rounded font-bold hover:bg-blue-900">ุญูุธ ูุฑุฏู</button></div>
            </form>
        </div>

        <div class="overflow-x-auto max-h-[400px]">
            <table class="w-full text-right border-collapse">
                <thead>
                    <tr>
                        <th>ุงูุจุงุญุซ</th><th>ุงูุนููุงู</th><th>ุงููุดุฑู</th><th>ุงูุฌุงูุนุฉ</th><th>ุงููููุฉ</th><th>ุงููุณู</th><th>ุงูุณูุฉ</th><th>ุงูุฑูู</th><th>ุงูุญุงูุฉ</th><th>ุงูุฑุงุจุท</th><th>ููุงุญุธุงุช</th>
                    </tr>
                </thead>
                <tbody id="previewBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
            authDomain: "libyan-theses-portal.firebaseapp.com",
            projectId: "libyan-theses-portal",
            databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
            appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // ุญูุธ ูุฑุฏู
        document.getElementById('uploadForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = {
                author: document.getElementById('author').value,
                title: document.getElementById('title').value,
                sup: document.getElementById('sup').value,
                uni: document.getElementById('uni').value,
                college: document.getElementById('college').value,
                dept: document.getElementById('dept').value,
                year: document.getElementById('year').value,
                id: document.getElementById('id').value,
                status: document.getElementById('status').value,
                link: document.getElementById('link').value,
                notes: document.getElementById('notes').value
            };
            db.ref('theses').push(data).then(() => { alert('ุชู ุงูุญูุธ!'); location.reload(); });
        });

        // ุชุญููู ุงููุงูุจ ุจุงูุชุฑุชูุจ ุงูุฌุฏูุฏ
        function downloadTemplate() {
            const headers = [["ุงูุจุงุญุซ", "ุงูุนููุงู", "ุงููุดุฑู", "ุงูุฌุงูุนุฉ", "ุงููููุฉ", "ุงููุณู", "ุงูุณูุฉ", "ุฑูู ุงูุฑุณุงูุฉ", "ุงูุญุงูุฉ", "ุงูุฑุงุจุท", "ุงูููุงุญุธุงุช"]];
            const ws = XLSX.utils.aoa_to_sheet(headers);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Template");
            XLSX.writeFile(wb, "Libyan_Theses_Template.xlsx");
        }

        // ูุนุงูุฌุฉ ุงูุฅูุณู
        function handleExcel(e) {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                const workbook = XLSX.read(new Uint8Array(event.target.result), {type: 'array'});
                const jsonData = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                jsonData.forEach(row => {
                    db.ref('theses').push({
                        author: row["ุงูุจุงุญุซ"], title: row["ุงูุนููุงู"], sup: row["ุงููุดุฑู"],
                        uni: row["ุงูุฌุงูุนุฉ"], college: row["ุงููููุฉ"], dept: row["ุงููุณู"],
                        year: row["ุงูุณูุฉ"], id: row["ุฑูู ุงูุฑุณุงูุฉ"], status: row["ุงูุญุงูุฉ"],
                        link: row["ุงูุฑุงุจุท"], notes: row["ุงูููุงุญุธุงุช"]
                    });
                });
                alert('ุชู ุฑูุน ' + jsonData.length + ' ุฑุณุงูุฉ!');
                location.reload();
            };
            reader.readAsArrayBuffer(file);
        }
    </script>
</body>
</html>
