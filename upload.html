<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ | Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-size: 11px; background-color: #f1f5f9; font-family: sans-serif; padding: 5px; }
        .main-card { background: white; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); border-top: 4px solid #1e3a8a; margin-bottom: 5px; }
        input, select, textarea { width: 100%; padding: 4px; border: 1px solid #cbd5e1; border-radius: 3px; font-size: 11px; }
        label { font-weight: bold; color: #1e3a8a; display: block; margin-bottom: 2px; }
        .btn { padding: 4px 12px; border-radius: 4px; font-weight: bold; cursor: pointer; color: white; border: none; font-size: 11px; transition: 0.2s; }
        .btn-excel { background: #15803d; } .btn-excel:hover { background: #065f46; }
        .btn-upload { background: #ea580c; } .btn-upload:hover { background: #9a3412; }
        .btn-save { background: #1e3a8a; }
    </style>
</head>
<body>

    <div class="flex justify-between items-center mb-2 px-2">
        <div class="flex gap-2">
            <button onclick="generateExcelTemplate()" class="btn btn-excel">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ù„Ø¨ Ø§Ù„Ø¥ÙƒØ³Ù„ (RTL)</button>
            
            <button onclick="document.getElementById('fileInput').click()" class="btn btn-upload">ğŸ“¤ Ø±ÙØ¹ Ù…Ù„Ù Ø¥ÙƒØ³Ù„ Ø¬Ø§Ù‡Ø²</button>
            <input type="file" id="fileInput" class="hidden" accept=".xlsx, .xls" onchange="handleFileUpload(event)">
        </div>
        <h1 class="text-blue-900 font-bold text-xs italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</h1>
    </div>

    <div class="main-card p-3 border">
        <form id="thesisForm">
            <div class="grid grid-cols-4 gap-3 mb-2">
                <div><label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«</label><input type="text" id="author" required></div>
                <div><label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label><input type="text" id="title" required></div>
                <div><label>Ø§Ù„Ù…Ø´Ø±Ù</label><input type="text" id="supervisor"></div>
                <div><label>Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label><input type="text" id="serialNum"></div>
            </div>
            <div class="grid grid-cols-3 gap-3 mb-2">
                <div><label>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</label><input type="text" id="university" required></div>
                <div><label>Ø§Ù„ÙƒÙ„ÙŠØ©</label><input type="text" id="college" required></div>
                <div><label>Ø§Ù„Ù‚Ø³Ù…</label><input type="text" id="department" required></div>
            </div>
            <div class="grid grid-cols-4 gap-3 mb-2">
                <div><label>Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©</label><select id="degree"><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option></select></div>
                <div><label>Ø§Ù„Ø­Ø§Ù„Ø©</label><select id="status"><option>Ù…ØªÙˆÙØ±Ø©</option><option>ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</option><option>ØªØ­Øª Ø§Ù„Ù…Ù†Ø§Ù‚Ø´Ø©</option></select></div>
                <div><label>Ø§Ù„Ø³Ù†Ø©</label><input type="number" id="year"></div>
                <div><label>Ø§Ù„Ø±Ø§Ø¨Ø· (URL)</label><input type="url" id="link"></div>
            </div>
            <div class="mb-2">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                <textarea id="notes" rows="1"></textarea>
            </div>
            <div class="text-left mt-1 border-t pt-2">
                <button type="submit" class="btn btn-save px-10">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…</button>
            </div>
        </form>
    </div>

<script>
    // 1. ÙˆØ¸ÙŠÙØ© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ù„Ø¨ (ØªØµÙ†Ø¹ Ù…Ù„Ù Ø¥ÙƒØ³Ù„ ÙÙŠ Ø«Ø§Ù†ÙŠØ©)
    function generateExcelTemplate() {
        const headers = [["Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«", "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "Ø§Ù„Ù…Ø´Ø±Ù", "Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©", "Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©", "Ø§Ù„ÙƒÙ„ÙŠØ©", "Ø§Ù„Ù‚Ø³Ù…", "Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©", "Ø§Ù„Ø³Ù†Ø©", "Ø§Ù„Ø­Ø§Ù„Ø©", "Ø§Ù„Ø±Ø§Ø¨Ø·", "Ù…Ù„Ø§Ø­Ø¸Ø§Øª"]];
        const ws = XLSX.utils.aoa_to_sheet(headers);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Template");
        XLSX.writeFile(wb, "Ù‚Ø§Ù„Ø¨_Ø§Ù„ÙÙ‡Ø±Ø³_Ø§Ù„Ù„ÙŠØ¨ÙŠ_Ø§Ù„Ù…ÙˆØ­Ø¯.xlsx");
    }

    // 2. ÙˆØ¸ÙŠÙØ© Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ Ø§Ù„Ù…Ø±ÙÙˆØ¹
    function handleFileUpload(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        reader.onload = (e) => {
            const data = new Uint8Array(e.target.result);
            const workbook = XLSX.read(data, {type: 'array'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            const json = XLSX.utils.sheet_to_json(sheet);
            
            if(confirm(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ (${json.length}) Ø³Ø¬Ù„. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¹Ù‡Ù… Ø§Ù„Ø¢Ù†ØŸ`)) {
                json.forEach(row => {
                    db.ref('theses_data').push({
                        author: row["Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«"] || "",
                        title: row["Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©"] || "",
                        university: row["Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©"] || "",
                        college: row["Ø§Ù„ÙƒÙ„ÙŠØ©"] || "",
                        year: row["Ø§Ù„Ø³Ù†Ø©"] || "",
                        status: row["Ø§Ù„Ø­Ø§Ù„Ø©"] || "Ù…ØªÙˆÙØ±Ø©"
                    });
                });
                alert("ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!");
            }
        };
        reader.readAsArrayBuffer(file);
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc",
        authDomain: "libyan-theses-portal.firebaseapp.com",
        projectId: "libyan-theses-portal",
        databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app",
        appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc"
    };
    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø­ÙØ¸ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙŠØ¯ÙˆÙŠ
    document.getElementById('thesisForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const data = {
            author: document.getElementById('author').value,
            title: document.getElementById('title').value,
            university: document.getElementById('university').value,
            college: document.getElementById('college').value,
            year: document.getElementById('year').value,
            degree: document.getElementById('degree').value,
            status: document.getElementById('status').value
        };
        db.ref('theses_data').push(data).then(() => {
            alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            document.getElementById('thesisForm').reset();
        });
    });
</script>
</body>
</html>
