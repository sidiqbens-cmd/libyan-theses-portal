<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ | Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-size: 11px; background-color: #f1f5f9; padding: 5px; }
        .main-card { background: white; border-radius: 4px; border-top: 4px solid #1e3a8a; margin-bottom: 5px; border-right:1px solid #ddd; border-left:1px solid #ddd; border-bottom:1px solid #ddd; }
        input, select { width: 100%; padding: 4px; border: 1px solid #cbd5e1; border-radius: 3px; font-size: 11px; outline: none; }
        th { background: #1e3a8a; color: white; padding: 4px; border: 1px solid #cbd5e1; position: sticky; top: 0; }
        td { padding: 3px; border: 1px solid #e2e8f0; text-align: center; background: white; }
        .edit-mode { background: #fffde7 !important; border: 1px solid #fbc02d !important; font-weight: bold; }
    </style>
</head>
<body>
    <div class="flex justify-between items-center mb-2 px-2">
        <div class="flex gap-2">
            <button onclick="downloadTemplate()" class="bg-green-700 text-white px-3 py-1 rounded">ğŸ“¥ Ù‚Ø§Ù„Ø¨ Ø¥ÙƒØ³Ù„</button>
            <button onclick="document.getElementById('xlFile').click()" class="bg-orange-600 text-white px-3 py-1 rounded">ğŸ“¤ Ø±ÙØ¹ Ø¥ÙƒØ³Ù„</button>
            <input type="file" id="xlFile" class="hidden" accept=".xlsx, .xls" onchange="importExcel(event)">
        </div>
        <h1 class="text-blue-900 font-bold text-xs italic">Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ù„ÙŠØ¨ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ | Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
    </div>

    <div class="main-card p-3">
        <form id="thesisForm">
            <div class="grid grid-cols-4 gap-2 mb-2">
                <input type="text" id="author" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«" required>
                <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©" required>
                <input type="text" id="supervisor" placeholder="Ø§Ù„Ù…Ø´Ø±Ù">
                <input type="text" id="serialNum" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
            </div>
            <div class="grid grid-cols-3 gap-2 mb-2">
                <input type="text" id="university" placeholder="Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" required>
                <input type="text" id="college" placeholder="Ø§Ù„ÙƒÙ„ÙŠØ©" required>
                <input type="text" id="department" placeholder="Ø§Ù„Ù‚Ø³Ù…" required>
            </div>
            <div class="grid grid-cols-4 gap-2 mb-2">
                <select id="degree"><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option></select>
                <select id="status"><option>Ù…ØªÙˆÙØ±Ø©</option><option>ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</option></select>
                <input type="number" id="year" placeholder="Ø§Ù„Ø³Ù†Ø©">
                <input type="url" id="link" placeholder="Ø§Ù„Ø±Ø§Ø¨Ø·">
            </div>
            <div class="flex gap-2">
                <input type="text" id="notes" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª">
                <button type="submit" class="bg-blue-900 text-white font-bold px-6 py-1 rounded">Ø­ÙØ¸ âœ…</button>
            </div>
        </form>
    </div>

    <div class="main-card p-2 bg-blue-50 grid grid-cols-6 gap-2 border-blue-200 border">
        <input type="text" id="gSearch" placeholder="ğŸ” Ø¨Ø­Ø« Ø´Ø§Ù…Ù„..." onkeyup="applyFilters()" class="border-blue-300">
        <input type="text" id="fUni" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" onkeyup="applyFilters()">
        <input type="text" id="fColl" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„ÙƒÙ„ÙŠØ©" onkeyup="applyFilters()">
        <input type="text" id="fDept" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ù‚Ø³Ù…" onkeyup="applyFilters()">
        <input type="text" id="fYear" placeholder="ØªØµÙÙŠØ© Ø¨Ø§Ù„Ø³Ù†Ø©" onkeyup="applyFilters()">
        <select id="fDeg" onchange="applyFilters()"><option value="">ÙƒÙ„ Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</option><option>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option></select>
    </div>

    <div class="main-card overflow-hidden h-[400px] overflow-y-auto">
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¨Ø§Ø­Ø«</th><th class="w-1/4">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©</th><th>Ø§Ù„ÙƒÙ„ÙŠØ©</th><th>Ø§Ù„Ù‚Ø³Ù…</th><th>Ø§Ù„Ø³Ù†Ø©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø±Ù‚Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©</th><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody id="thesesTableBody"></tbody>
        </table>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyAogBGo2_OzNito9D9AXVyAjSjmu-DYotc", authDomain: "libyan-theses-portal.firebaseapp.com", projectId: "libyan-theses-portal", databaseURL: "https://libyan-theses-portal-default-rtdb.europe-west1.firebasedatabase.app", appId: "1:80818219253:web:5ca7224ac6a5c8a7377dbc" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref('theses_data').on('value', snap => {
        const tbody = document.getElementById('thesesTableBody');
        tbody.innerHTML = '';
        snap.forEach(child => {
            const v = child.val(); const id = child.key;
            tbody.innerHTML += `<tr id="row-${id}">
                <td>${v.author}</td><td class="text-right">${v.title}</td><td>${v.university}</td><td>${v.college}</td><td>${v.department}</td><td>${v.year}</td><td>${v.degree}</td><td>${v.serialNum}</td>
                <td><button onclick="enableEdit('${id}')" class="bg-yellow-600 text-white px-1 rounded">ØªØ¹Ø¯ÙŠÙ„</button> <button onclick="deleteRec('${id}')" class="bg-red-600 text-white px-1 rounded">X</button></td>
            </tr>`;
        });
    });

    function applyFilters() {
        const gs = document.getElementById('gSearch').value.toLowerCase();
        const u = document.getElementById('fUni').value.toLowerCase();
        const c = document.getElementById('fColl').value.toLowerCase();
        const d = document.getElementById('fDept').value.toLowerCase();
        const y = document.getElementById('fYear').value.toLowerCase();
        const deg = document.getElementById('fDeg').value;
        
        document.querySelectorAll('#thesesTableBody tr').forEach(row => {
            const t = row.innerText.toLowerCase();
            const cells = row.getElementsByTagName('td');
            const match = t.includes(gs) && cells[2].innerText.toLowerCase().includes(u) && cells[3].innerText.toLowerCase().includes(c) && cells[4].innerText.toLowerCase().includes(d) && cells[5].innerText.toLowerCase().includes(y) && (deg=="" || cells[6].innerText==deg);
            row.style.display = match ? "" : "none";
        });
    }

    function enableEdit(id) {
        const row = document.getElementById(`row-${id}`);
        const cells = row.getElementsByTagName('td');
        const old = { a:cells[0].innerText, t:cells[1].innerText, u:cells[2].innerText, c:cells[3].innerText, d:cells[4].innerText, y:cells[5].innerText, deg:cells[6].innerText, sn:cells[7].innerText };
        row.innerHTML = `
            <td><input class="edit-mode" id="e-a-${id}" value="${old.a}"></td><td><input class="edit-mode" id="e-t-${id}" value="${old.t}"></td><td><input class="edit-mode" id="e-u-${id}" value="${old.u}"></td><td><input class="edit-mode" id="e-c-${id}" value="${old.c}"></td><td><input class="edit-mode" id="e-d-${id}" value="${old.d}"></td><td><input class="edit-mode" id="e-y-${id}" value="${old.y}"></td><td><select class="edit-mode" id="e-deg-${id}"><option ${old.deg=='Ù…Ø§Ø¬Ø³ØªÙŠØ±'?'selected':''}>Ù…Ø§Ø¬Ø³ØªÙŠØ±</option><option ${old.deg=='Ø¯ÙƒØªÙˆØ±Ø§Ø©'?'selected':''}>Ø¯ÙƒØªÙˆØ±Ø§Ø©</option></select></td><td><input class="edit-mode" id="e-sn-${id}" value="${old.sn}"></td>
            <td><button onclick="saveEdit('${id}')" class="bg-green-600 text-white px-2 rounded">Ø­ÙØ¸</button></td>`;
    }

    function saveEdit(id) {
        const up = { author:document.getElementById(`e-a-${id}`).value, title:document.getElementById(`e-t-${id}`).value, university:document.getElementById(`e-u-${id}`).value, college:document.getElementById(`e-c-${id}`).value, department:document.getElementById(`e-d-${id}`).value, year:document.getElementById(`e-y-${id}`).value, degree:document.getElementById(`e-deg-${id}`).value, serialNum:document.getElementById(`e-sn-${id}`).value };
        db.ref('theses_data').child(id).update(up).then(() => alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"));
    }

    document.getElementById('thesisForm').onsubmit = (e) => {
        e.preventDefault();
        const data = { author:document.getElementById('author').value, title:document.getElementById('title').value, supervisor:document.getElementById('supervisor').value, serialNum:document.getElementById('serialNum').value, university:document.getElementById('university').value, college:document.getElementById('college').value, department:document.getElementById('department').value, degree:document.getElementById('degree').value, status:document.getElementById('status').value, year:document.getElementById('year').value, link:document.getElementById('link').value, notes:document.getElementById('notes').value };
        db.ref('theses_data').push(data).then(() => { alert("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…"); document.getElementById('thesisForm').reset(); });
    };

    function deleteRec(id) { if(confirm("Ø­Ø°ÙØŸ")) db.ref('theses_data').child(id).remove(); }
</script>
</body>
</html>
